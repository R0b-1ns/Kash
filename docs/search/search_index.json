{"config":{"lang":["fr"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Finance Manager","text":"<p>Personal finance manager with OCR and local AI.</p>"},{"location":"#features","title":"Features","text":"<ul> <li>Document Upload: Photos of receipts, PDF invoices, pay stubs</li> <li>Smart OCR: Automatic text extraction with PaddleOCR</li> <li>Local AI: Data categorization and extraction with Ollama/Mistral</li> <li>Interactive Dashboard: Charts, statistics, budget tracking</li> <li>Customizable Tags: Flexible categorization system</li> <li>Multi-currency: Currency support for travels</li> <li>CSV Export: Easily export your data</li> <li>NAS Synchronization: Automatic backup to your NAS</li> </ul>"},{"location":"#tech-stack","title":"Tech Stack","text":"Component Technology Backend FastAPI, SQLAlchemy, PostgreSQL Frontend React 18, TypeScript, Tailwind CSS OCR PaddleOCR AI Ollama with Mistral 7B Containerization Docker Compose"},{"location":"#quick-start","title":"Quick Start","text":"<pre><code># Clone the project\ngit clone &lt;repository&gt;\ncd gestionnaireDeFinance\n\n# Configure the environment\ncp .env.example .env\n\n# Launch with Docker\ndocker compose up -d\n\n# Access the application\nopen http://localhost:3000\n</code></pre>"},{"location":"#architecture","title":"Architecture","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    Frontend (React)                      \u2502\n\u2502                   http://localhost:3000                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                        \u2502 REST API\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                   Backend (FastAPI)                      \u2502\n\u2502                   http://localhost:8000                  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502  \u2502   OCR   \u2502  \u2502   AI    \u2502  \u2502  Export \u2502  \u2502   Sync  \u2502    \u2502\n\u2502  \u2502 Service \u2502  \u2502 Service \u2502  \u2502 Service \u2502  \u2502 Service \u2502    \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2502       \u2502            \u2502                          \u2502         \u2502\n\u2502       \u25bc            \u25bc                          \u25bc         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n\u2502  \u2502PaddleOCR\u2502  \u2502 Ollama  \u2502              \u2502  rsync  \u2502     \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518              \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                      \u2502                       \u2502\n              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n              \u2502  PostgreSQL   \u2502        \u2502     NAS     \u2502\n              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"#useful-links","title":"Useful Links","text":"<ul> <li>Installation Guide</li> <li>Configuration</li> <li>API Reference</li> <li>Swagger Documentation</li> </ul>"},{"location":"api/auth/","title":"Authentication API","text":"<p>Base URL: <code>/api/v1/auth</code></p>"},{"location":"api/auth/#endpoints","title":"Endpoints","text":""},{"location":"api/auth/#post-register","title":"POST /register","text":"<p>Creates a new user account.</p> <p>Request Body: <pre><code>{\n  \"email\": \"user@example.com\",\n  \"password\": \"securepassword123\",\n  \"name\": \"John Doe\"\n}\n</code></pre></p> <p>Response (201): <pre><code>{\n  \"id\": 1,\n  \"email\": \"user@example.com\",\n  \"name\": \"John Doe\",\n  \"created_at\": \"2024-01-15T10:30:00Z\"\n}\n</code></pre></p> <p>Errors:</p> Code Description 400 Email already registered 422 Invalid data"},{"location":"api/auth/#post-login","title":"POST /login","text":"<p>Authenticates a user and returns a JWT token.</p> <p>Request Body: <pre><code>{\n  \"email\": \"user@example.com\",\n  \"password\": \"securepassword123\"\n}\n</code></pre></p> <p>Response (200): <pre><code>{\n  \"access_token\": \"eyJhbGciOiJIUzI1NiIs...\",\n  \"token_type\": \"bearer\"\n}\n</code></pre></p> <p>Errors:</p> Code Description 401 Incorrect email or password 422 Invalid data"},{"location":"api/auth/#get-me","title":"GET /me","text":"<p>Retrieves information about the logged-in user.</p> <p>Headers: <pre><code>Authorization: Bearer &lt;token&gt;\n</code></pre></p> <p>**Response (200): <pre><code>{\n  \"id\": 1,\n  \"email\": \"user@example.com\",\n  \"name\": \"John Doe\",\n  \"created_at\": \"2024-01-15T10:30:00Z\"\n}\n</code></pre></p> <p>Errors:</p> Code Description 401 Invalid or expired token"},{"location":"api/auth/#jwt-authentication","title":"JWT Authentication","text":""},{"location":"api/auth/#token-format","title":"Token Format","text":"<p>JWT tokens are signed with the HS256 algorithm and contain:</p> <pre><code>{\n  \"sub\": \"user@example.com\",\n  \"exp\": 1705320000\n}\n</code></pre> <ul> <li><code>sub</code>: User email</li> <li><code>exp</code>: Expiration timestamp (7 days by default)</li> </ul>"},{"location":"api/auth/#usage","title":"Usage","text":"<p>Include the token in the <code>Authorization</code> header:</p> <pre><code>curl -H \"Authorization: Bearer eyJhbGciOiJIUzI1NiIs...\" \\\n     http://localhost:8000/api/v1/auth/me\n</code></pre>"},{"location":"api/auth/#expiration","title":"Expiration","text":"<p>Tokens expire after 7 days (configurable via <code>ACCESS_TOKEN_EXPIRE_MINUTES</code>).</p> <p>When a token expires, the API returns a 401 error and the client must re-authenticate.</p>"},{"location":"api/budgets/","title":"Budgets API","text":"<p>Base URL: <code>/api/v1/budgets</code></p> <p>Budgets allow setting monthly spending limits per category (tag).</p>"},{"location":"api/budgets/#endpoints","title":"Endpoints","text":""},{"location":"api/budgets/#get","title":"GET /","text":"<p>Lists all budgets.</p> <p>Query Parameters:</p> Parameter Type Description month string Filter by month (format: YYYY-MM) <p>Response (200): <pre><code>[\n  {\n    \"id\": 1,\n    \"tag_id\": 1,\n    \"month\": \"2024-01\",\n    \"limit_amount\": 500.00,\n    \"currency\": \"EUR\",\n    \"created_at\": \"2024-01-01T00:00:00Z\",\n    \"updated_at\": \"2024-01-01T00:00:00Z\",\n    \"tag\": {\n      \"id\": 1,\n      \"name\": \"Groceries\",\n      \"color\": \"#22c55e\"\n    }\n  }\n]\n</code></pre></p>"},{"location":"api/budgets/#get-current","title":"GET /current","text":"<p>Retrieves budgets for the current month with calculated spending.</p> <p>This is the main endpoint for the dashboard and budget page.</p> <p>Query Parameters:</p> Parameter Type Description month string Target month (format: YYYY-MM, default: current month) <p>Response (200): <pre><code>[\n  {\n    \"id\": 1,\n    \"tag_id\": 1,\n    \"tag_name\": \"Groceries\",\n    \"tag_color\": \"#22c55e\",\n    \"month\": \"2024-01\",\n    \"limit_amount\": 500.00,\n    \"currency\": \"EUR\",\n    \"spent_amount\": 325.50,\n    \"remaining_amount\": 174.50,\n    \"percentage_used\": 65.1\n  },\n  {\n    \"id\": 2,\n    \"tag_id\": 2,\n    \"tag_name\": \"Transport\",\n    \"tag_color\": \"#3b82f6\",\n    \"month\": \"2024-01\",\n    \"limit_amount\": 150.00,\n    \"currency\": \"EUR\",\n    \"spent_amount\": 180.00,\n    \"remaining_amount\": -30.00,\n    \"percentage_used\": 120.0\n  }\n]\n</code></pre></p> <p>Spending Calculation</p> <p><code>spent_amount</code> is calculated in real-time from documents of the month with the corresponding tag.</p>"},{"location":"api/budgets/#post","title":"POST /","text":"<p>Creates a new budget.</p> <p>Request Body: <pre><code>{\n  \"tag_id\": 1,\n  \"month\": \"2024-01\",\n  \"limit_amount\": 500.00,\n  \"currency\": \"EUR\"\n}\n</code></pre></p> Field Type Required Description tag_id int Yes ID of the associated tag month string Yes Month (format: YYYY-MM) limit_amount number Yes Spending limit currency string No Currency (default: EUR) <p>Response (201): <pre><code>{\n  \"id\": 1,\n  \"tag_id\": 1,\n  \"month\": \"2024-01\",\n  \"limit_amount\": 500.00,\n  \"currency\": \"EUR\",\n  \"created_at\": \"2024-01-01T00:00:00Z\",\n  \"updated_at\": \"2024-01-01T00:00:00Z\"\n}\n</code></pre></p> <p>Errors:</p> Code Description 400 Budget already exists for this tag/month 404 Tag not found"},{"location":"api/budgets/#put-id","title":"PUT /{id}","text":"<p>Updates a budget.</p> <p>Request Body: <pre><code>{\n  \"limit_amount\": 600.00\n}\n</code></pre></p> Field Type Description limit_amount number New limit currency string New currency <p>Response (200): Budget updated</p>"},{"location":"api/budgets/#delete-id","title":"DELETE /{id}","text":"<p>Deletes a budget.</p> <p>Response (204): No Content</p>"},{"location":"api/budgets/#visual-indicators","title":"Visual Indicators","text":"<p>The percentage of usage determines the indicator's color:</p> Usage Percentage Color Meaning 0-50% Green (<code>#22c55e</code>) Comfortable 50-75% Yellow (<code>#eab308</code>) Watch out 75-90% Orange (<code>#f97316</code>) Close to limit 90%+ Red (<code>#ef4444</code>) Limit exceeded"},{"location":"api/budgets/#example-usage","title":"Example Usage","text":""},{"location":"api/budgets/#create-monthly-budgets","title":"Create monthly budgets","text":"<pre><code>// Create a groceries budget\nawait budgets.create({\n  tag_id: 1, // ID of \"Groceries\" tag\n  month: \"2024-01\",\n  limit_amount: 500\n});\n\n// Create a transport budget\nawait budgets.create({\n  tag_id: 2, // ID of \"Transport\" tag\n  month: \"2024-01\",\n  limit_amount: 150\n});\n</code></pre>"},{"location":"api/budgets/#display-progress","title":"Display progress","text":"<pre><code>const current = await budgets.getCurrent(\"2024-01\");\n\ncurrent.forEach(budget =&gt; {\n  console.log(`${budget.tag_name}: ${budget.percentage_used}%`);\n  if (budget.percentage_used &gt; 100) {\n    console.log(\"\u26a0\ufe0f Budget exceeded!\");\n  }\n});\n</code></pre>"},{"location":"api/documents/","title":"Documents API","text":"<p>Base URL: <code>/api/v1/documents</code></p> <p>All endpoints require authentication (header <code>Authorization: Bearer &lt;token&gt;</code>).</p>"},{"location":"api/documents/#endpoints","title":"Endpoints","text":""},{"location":"api/documents/#get","title":"GET /","text":"<p>Lists documents for the logged-in user.</p> <p>Query Parameters:</p> Parameter Type Description search string Text search (merchant, location, filename) ocr_search string Text search in raw OCR content min_amount float Minimum total amount max_amount float Maximum total amount tag_ids string Comma-separated tag IDs min_confidence float Minimum OCR confidence score (0-100) skip int Offset for pagination (default: 0) limit int Max number of items to return (default: 100) start_date date Filter from this date end_date date Filter up to this date is_income bool Filter income/expenses doc_type string Filter by type (receipt, invoice...) <p>Response (200): <pre><code>[\n  {\n    \"id\": 1,\n    \"original_name\": \"ticket-carrefour.jpg\",\n    \"doc_type\": \"receipt\",\n    \"date\": \"2024-01-15\",\n    \"merchant\": \"Carrefour\",\n    \"total_amount\": 45.67,\n    \"currency\": \"EUR\",\n    \"is_income\": false,\n    \"created_at\": \"2024-01-15T10:30:00Z\",\n    \"tags\": [\n      {\"id\": 1, \"name\": \"Groceries\", \"color\": \"#22c55e\"}\n    ]\n  }\n]\n</code></pre></p>"},{"location":"api/documents/#post-upload","title":"POST /upload","text":"<p>Uploads a new document (image or PDF).</p> <p>Content-Type: <code>multipart/form-data</code></p> <p>Form Data:</p> Field Type Description file File File to upload (required) <p>Accepted Formats: JPG, JPEG, PNG, WEBP, BMP, PDF</p> <p>Max size: 50 MB</p> <p>Response (201): <pre><code>{\n  \"id\": 1,\n  \"file_path\": \"/app/uploads/2024-01-15_abc123_ticket.jpg\",\n  \"original_name\": \"ticket-carrefour.jpg\",\n  \"file_type\": \"image/jpeg\",\n  \"doc_type\": \"receipt\",\n  \"date\": \"2024-01-15\",\n  \"time\": \"14:30:00\",\n  \"merchant\": \"Carrefour\",\n  \"location\": \"Paris 15e\",\n  \"total_amount\": 45.67,\n  \"currency\": \"EUR\",\n  \"is_income\": false,\n  \"ocr_raw_text\": \"CARREFOUR\\n...\",\n  \"ocr_confidence\": 92.5,\n  \"synced_to_nas\": false,\n  \"tags\": [],\n  \"items\": [\n    {\n      \"id\": 1,\n      \"name\": \"Golden Apples\",\n      \"quantity\": 1.5,\n      \"unit\": \"kg\",\n      \"unit_price\": 2.99,\n      \"total_price\": 4.49,\n      \"category\": \"Fruits\"\n    }\n  ]\n}\n</code></pre></p> <p>Automatic Processing</p> <p>Upload automatically triggers: 1. OCR (text extraction) 2. AI (data analysis and extraction) 3. Item creation (articles)</p>"},{"location":"api/documents/#get-id","title":"GET /{id}","text":"<p>Retrieves details of a document.</p> <p>Response (200): <pre><code>{\n  \"id\": 1,\n  \"file_path\": \"/app/uploads/2024-01-15_abc123_ticket.jpg\",\n  \"original_name\": \"ticket-carrefour.jpg\",\n  \"doc_type\": \"receipt\",\n  \"date\": \"2024-01-15\",\n  \"merchant\": \"Carrefour\",\n  \"total_amount\": 45.67,\n  \"currency\": \"EUR\",\n  \"is_income\": false,\n  \"ocr_raw_text\": \"CARREFOUR\\nParis 15e...\",\n  \"tags\": [...],\n  \"items\": [...]\n}\n</code></pre></p> <p>Errors:</p> Code Description 404 Document not found"},{"location":"api/documents/#put-id","title":"PUT /{id}","text":"<p>Updates a document.</p> <p>Request Body: <pre><code>{\n  \"doc_type\": \"invoice\",\n  \"date\": \"2024-01-15\",\n  \"merchant\": \"EDF\",\n  \"total_amount\": 120.50,\n  \"currency\": \"EUR\",\n  \"is_income\": false\n}\n</code></pre></p> <p>All fields are optional.</p> <p>Response (200): Document updated</p>"},{"location":"api/documents/#delete-id","title":"DELETE /{id}","text":"<p>Deletes a document and its associated items.</p> <p>Response (204): No Content</p>"},{"location":"api/documents/#post-idreprocess","title":"POST /{id}/reprocess","text":"<p>Re-runs OCR/AI extraction on an existing document.</p> <p>Useful if initial extraction failed or to re-analyze after AI model update.</p> <p>Response (200): Document with new extracted data</p>"},{"location":"api/documents/#post-idtagstag_id","title":"POST /{id}/tags/{tag_id}","text":"<p>Adds a tag to a document.</p> <p>Response (200): Document with tag added</p> <p>Errors:</p> Code Description 404 Document or tag not found 400 Tag already associated"},{"location":"api/documents/#delete-idtagstag_id","title":"DELETE /{id}/tags/{tag_id}","text":"<p>Removes a tag from a document.</p> <p>Response (200): Document without the tag</p>"},{"location":"api/documents/#example-upload-with-curl","title":"Example upload with cURL","text":"<pre><code>curl -X POST \"http://localhost:8000/api/v1/documents/upload\" \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -F \"file=@/path/to/ticket.jpg\"\n</code></pre>"},{"location":"api/documents/#example-upload-with-javascript","title":"Example upload with JavaScript","text":"<pre><code>const formData = new FormData();\nformData.append('file', fileInput.files[0]);\n\nconst response = await fetch('/api/v1/documents/upload', {\n  method: 'POST',\n  headers: {\n    'Authorization': `Bearer ${token}`\n  },\n  body: formData\n});\n\nconst document = await response.json();\n</code></pre>"},{"location":"api/export/","title":"Export API","text":"<p>Base URL: <code>/api/v1/export</code></p> <p>Endpoints for exporting data in CSV format.</p>"},{"location":"api/export/#endpoints","title":"Endpoints","text":""},{"location":"api/export/#get-documentscsv","title":"GET /documents/csv","text":"<p>Exports documents in CSV format.</p> <p>Query Parameters:</p> Parameter Type Description start_date date Start date (format: YYYY-MM-DD) end_date date End date (format: YYYY-MM-DD) tag_ids int[] Filter by tags (can be repeated) include_items bool Include item details (default: false) <p>Response (200): - Content-Type: <code>text/csv; charset=utf-8</code> - Content-Disposition: <code>attachment; filename=\"documents_*.csv\"</code></p>"},{"location":"api/export/#format-without-items-default","title":"Format without items (default)","text":"<p>One line per document:</p> <pre><code>ID;Date;Time;Merchant;Location;Type;Amount;Currency;Transaction Type;Tags;Original File\n1;2024-01-15;14:30:00;Carrefour;Paris 15e;receipt;45.67;EUR;Expense;Groceries;ticket-carrefour.jpg\n2;2024-01-16;09:15:00;RATP;Paris;receipt;16.90;EUR;Expense;Transport;navigo.pdf\n</code></pre>"},{"location":"api/export/#format-with-items","title":"Format with items","text":"<p>One line per item:</p> <pre><code>Document ID;Date;Merchant;Item;Quantity;Unit;Unit Price;Total Price;Item Category;Document Tags\n1;2024-01-15;Carrefour;Golden Apples;1.50;kg;2.99;4.49;Fruits;Groceries\n1;2024-01-15;Carrefour;Baguette;2.00;;1.20;2.40;Bakery;Groceries\n1;2024-01-15;Carrefour;Milk;1.00;L;1.10;1.10;Dairy;Groceries\n</code></pre>"},{"location":"api/export/#get-monthlycsv","title":"GET /monthly/csv","text":"<p>Exports the monthly summary in CSV format.</p> <p>Query Parameters:</p> Parameter Type Required Description year int Yes Year (2000-2100) month int Yes Month (1-12) <p>Response (200): - Content-Type: <code>text/csv; charset=utf-8</code> - Content-Disposition: <code>attachment; filename=\"summary_YYYY-MM.csv\"</code></p> <p>Format:</p> <pre><code>Monthly Summary;2024-01\n\nMetric;Value\nTotal Expenses;1250.75 EUR\nTotal Income;3500.00 EUR\nBalance;2249.25 EUR\nNumber of transactions;42\n\nExpenses by Category\nTag;Amount;Percentage\nGroceries;450.30 EUR;36.0%\nTransport;180.00 EUR;14.4%\nHousing;400.00 EUR;32.0%\nLeisure;220.45 EUR;17.6%\n</code></pre>"},{"location":"api/export/#get-monthlypdf","title":"GET /monthly/pdf","text":"<p>Generates and exports the monthly PDF report with charts.</p> <p>Query Parameters:</p> Parameter Type Required Description year int Yes Report year (2000-2100) month int Yes Report month (1-12) <p>Response (200): - Content-Type: <code>application/pdf</code> - Content-Disposition: <code>attachment; filename=\"report_*.pdf\"</code></p> <p>Report Content</p> <p>The monthly PDF report includes a financial summary, category breakdown charts (donut), monthly evolution, top expenses and merchants, as well as budget tracking.</p>"},{"location":"api/export/#get-annualpdf","title":"GET /annual/pdf","text":"<p>Generates and exports the annual summary PDF report.</p> <p>Query Parameters:</p> Parameter Type Required Description year int Yes Report year (2000-2100) <p>Response (200): - Content-Type: <code>application/pdf</code> - Content-Disposition: <code>attachment; filename=\"annual_report_*.pdf\"</code></p> <p>Report Content</p> <p>The annual PDF report contains a summary of the year, monthly evolution (line chart), a month-by-month comparison table, annual category breakdown, and top 10 expenses/merchants of the year.</p>"},{"location":"api/export/#get-chartchart_type","title":"GET /chart/{chart_type}","text":"<p>Exports an individual chart in PNG format.</p> <p>Path Parameters:</p> Parameter Type Required Description chart_type string Yes Chart type: <code>pie</code>, <code>bar</code>, <code>line</code>, <code>donut</code>, <code>area</code> <p>Query Parameters:</p> Parameter Type Required Description month string No Month to filter for the chart (YYYY-MM format) <p>Response (200): - Content-Type: <code>image/png</code> - Content-Disposition: <code>attachment; filename=\"chart_*.png\"</code></p>"},{"location":"api/export/#usage-examples","title":"Usage Examples","text":""},{"location":"api/export/#export-with-curl","title":"Export with cURL","text":"<pre><code># Basic export\ncurl -H \"Authorization: Bearer $TOKEN\" \\\n     \"http://localhost:8000/api/v1/export/documents/csv\" \\\n     -o documents.csv\n\n# Export with filters\ncurl -H \"Authorization: Bearer $TOKEN\" \\\n     \"http://localhost:8000/api/v1/export/documents/csv?start_date=2024-01-01&amp;end_date=2024-01-31&amp;tag_ids=1&amp;tag_ids=2\" \\\n     -o january.csv\n\n# Export with item details\ncurl -H \"Authorization: Bearer $TOKEN\" \\\n     \"http://localhost:8000/api/v1/export/documents/csv?include_items=true\" \\\n     -o documents_details.csv\n\n# Export monthly summary CSV\ncurl -H \"Authorization: Bearer $TOKEN\" \\\n     \"http://localhost:8000/api/v1/export/monthly/csv?year=2024&amp;month=1\" \\\n     -o january_summary.csv\n\n# Export monthly PDF report\ncurl -H \"Authorization: Bearer $TOKEN\" \\\n     \"http://localhost:8000/api/v1/export/monthly/pdf?year=2024&amp;month=1\" \\\n     -o january_report.pdf\n\n# Export annual PDF report\ncurl -H \"Authorization: Bearer $TOKEN\" \\\n     \"http://localhost:8000/api/v1/export/annual/pdf?year=2024\" \\\n     -o annual_report_2024.pdf\n\n# Export donut chart PNG for a month\ncurl -H \"Authorization: Bearer $TOKEN\" \\\n     \"http://localhost:8000/api/v1/export/chart/donut?month=2024-01\" \\\n     -o january_donut_chart.png\n</code></pre>"},{"location":"api/export/#export-with-javascript","title":"Export with JavaScript","text":"<pre><code>// Download documents export\nawait exportApi.documentsCSV({\n  start_date: \"2024-01-01\",\n  end_date: \"2024-01-31\",\n  tag_ids: [1, 2],\n  include_items: true\n});\n// The file is downloaded automatically\n\n// Download monthly summary CSV\nawait exportApi.monthlyCSV(2024, 1);\n\n// Download monthly PDF report\nawait exportApi.monthlyPDF(2024, 1);\n\n// Download annual PDF report\nawait exportApi.annualPDF(2024);\n\n// Download a chart PNG\nawait exportApi.exportChart('donut', '2024-01');\n</code></pre>"},{"location":"api/export/#notes","title":"Notes","text":"<p>Separator</p> <p>The separator used is the semicolon (<code>;</code>) for better compatibility with Excel (French version).</p> <p>Encoding</p> <p>Files are UTF-8 encoded with BOM to ensure correct display of accented characters in Excel.</p>"},{"location":"api/stats/","title":"Statistics API","text":"<p>Base URL: <code>/api/v1/stats</code></p> <p>Endpoints for retrieving statistics and dashboard data.</p>"},{"location":"api/stats/#endpoints","title":"Endpoints","text":""},{"location":"api/stats/#get-summary","title":"GET /summary","text":"<p>Retrieves the financial summary for a month.</p> <p>Query Parameters:</p> Parameter Type Description month string Target month (format: YYYY-MM, default: current month) <p>Response (200): <pre><code>{\n  \"month\": \"2024-01\",\n  \"total_expenses\": 1250.75,\n  \"total_income\": 3500.00,\n  \"balance\": 2249.25,\n  \"transaction_count\": 42\n}\n</code></pre></p> Field Description total_expenses Sum of documents where is_income=false total_income Sum of documents where is_income=true balance total_income - total_expenses transaction_count Total number of documents"},{"location":"api/stats/#get-by-tag","title":"GET /by-tag","text":"<p>Retrieves expenses grouped by tag.</p> <p>Query Parameters:</p> Parameter Type Description month string Target month (format: YYYY-MM, default: current month) <p>Response (200): <pre><code>[\n  {\n    \"tag_id\": 1,\n    \"tag_name\": \"Groceries\",\n    \"tag_color\": \"#22c55e\",\n    \"total_amount\": 450.30,\n    \"transaction_count\": 12,\n    \"percentage\": 36.0\n  },\n  {\n    \"tag_id\": 2,\n    \"tag_name\": \"Transport\",\n    \"tag_color\": \"#3b82f6\",\n    \"total_amount\": 180.00,\n    \"transaction_count\": 8,\n    \"percentage\": 14.4\n  },\n  {\n    \"tag_id\": null,\n    \"tag_name\": \"Uncategorized\",\n    \"tag_color\": \"#9ca3af\",\n    \"total_amount\": 620.45,\n    \"transaction_count\": 22,\n    \"percentage\": 49.6\n  }\n]\n</code></pre></p> <p>Untagged Documents</p> <p>Documents without tags are grouped under \"Uncategorized\" with <code>tag_id: null</code>.</p>"},{"location":"api/stats/#get-monthly","title":"GET /monthly","text":"<p>Retrieves expenses/income evolution over several months.</p> <p>Query Parameters:</p> Parameter Type Description months int Number of months to retrieve (default: 12, max: 24) <p>Response (200): <pre><code>[\n  {\n    \"month\": \"2023-02\",\n    \"expenses\": 1100.50,\n    \"income\": 3200.00\n  },\n  {\n    \"month\": \"2023-03\",\n    \"expenses\": 1350.25,\n    \"income\": 3200.00\n  },\n  {\n    \"month\": \"2024-01\",\n    \"expenses\": 1250.75,\n    \"income\": 3500.00\n  }\n]\n</code></pre></p> <p>Data is sorted by ascending month.</p>"},{"location":"api/stats/#get-top-items","title":"GET /top-items","text":"<p>Retrieves the most frequently purchased items.</p> <p>Query Parameters:</p> Parameter Type Description month string Target month (optional, all months if omitted) limit int Max number of results (default: 10) <p>Response (200): <pre><code>[\n  {\n    \"name\": \"Golden Apples\",\n    \"total_quantity\": 15.5,\n    \"total_spent\": 46.35,\n    \"purchase_count\": 8\n  },\n  {\n    \"name\": \"Traditional Baguette\",\n    \"total_quantity\": 24.0,\n    \"total_spent\": 28.80,\n    \"purchase_count\": 24\n  },\n  {\n    \"name\": \"Semi-skimmed Milk\",\n    \"total_quantity\": 12.0,\n    \"total_spent\": 13.20,\n    \"purchase_count\": 12\n  }\n]\n</code></pre></p> Field Description name Item name total_quantity Total quantity purchased total_spent Total amount spent purchase_count Number of times purchased"},{"location":"api/stats/#example-usage-for-the-dashboard","title":"Example usage for the dashboard","text":"<pre><code>// Load all dashboard data in parallel\nconst [summary, byTag, monthly, topItems, budgets] = await Promise.all([\n  stats.getSummary(\"2024-01\"),\n  stats.getByTag(\"2024-01\"),\n  stats.getMonthly(12),\n  stats.getTopItems({ month: \"2024-01\", limit: 5 }),\n  budgets.getCurrent(\"2024-01\")\n]);\n\n// Display summary\nconsole.log(`Balance: ${summary.balance}\u20ac`);\n\n// Pie chart by tag\nbyTag.forEach(tag =&gt; {\n  console.log(`${tag.tag_name}: ${tag.percentage}%`);\n});\n\n// Evolution chart\nmonthly.forEach(month =&gt; {\n  console.log(`${month.month}: +${month.income}\u20ac / -${month.expenses}\u20ac`);\n});\n</code></pre>"},{"location":"api/sync/","title":"Synchronization API","text":"<p>Base URL: <code>/api/v1/sync</code></p> <p>Endpoints for synchronizing files to NAS via SMB mount.</p>"},{"location":"api/sync/#prerequisites","title":"Prerequisites","text":"<p>Synchronization uses an SMB/CIFS mount (not SSH/rsync).</p>"},{"location":"api/sync/#1-mount-the-smb-share-on-mac","title":"1. Mount the SMB share on Mac","text":"<pre><code># Create mount point\nsudo mkdir -p /Volumes/NAS\n\n# Mount SMB share\nmount -t smbfs //username:password@NAS-IP/share /Volumes/NAS\n\n# Or via Finder: Cmd+K \u2192 smb://NAS-IP/share\n</code></pre>"},{"location":"api/sync/#2-configuration-in-env","title":"2. Configuration in <code>.env</code>","text":"<pre><code># Path on Mac (SMB mount)\nNAS_LOCAL_PATH=/Volumes/NAS/finance\n\n# Path in Docker container\nNAS_MOUNT_PATH=/app/nas_backup\n</code></pre>"},{"location":"api/sync/#3-docker-compose-configuration","title":"3. Docker compose configuration","text":"<pre><code>backend:\n  volumes:\n    - ${NAS_LOCAL_PATH:-./nas_backup}:/app/nas_backup\n  environment:\n    - NAS_MOUNT_PATH=${NAS_MOUNT_PATH:-}\n</code></pre>"},{"location":"api/sync/#endpoints","title":"Endpoints","text":""},{"location":"api/sync/#get-status","title":"GET /status","text":"<p>Retrieves synchronization statistics.</p> <p>Response (200): <pre><code>{\n  \"total_documents\": 150,\n  \"synced\": 142,\n  \"pending\": 8,\n  \"sync_percentage\": 94.7,\n  \"last_sync\": \"2024-01-15T14:30:00Z\",\n  \"nas_configured\": true\n}\n</code></pre></p> Field Description total_documents Total number of documents synced Synchronized documents pending Documents awaiting sync sync_percentage Synchronization percentage last_sync Date of last synchronization nas_configured NAS mount accessible"},{"location":"api/sync/#get-config","title":"GET /config","text":"<p>Retrieves NAS configuration status.</p> <p>Response (200): <pre><code>{\n  \"configured\": true,\n  \"nas_host\": true,\n  \"nas_user\": true,\n  \"nas_path\": true,\n  \"host\": \"SMB Mount\",\n  \"path\": \"/app/nas_backup\",\n  \"path_exists\": true,\n  \"path_writable\": true\n}\n</code></pre></p> Field Description configured Complete and functional configuration nas_host Legacy compatibility (always true if configured) nas_user Legacy compatibility (always true if configured) nas_path Mount path defined host \"SMB Mount\" (type indication) path Mount path in the container path_exists Directory exists path_writable Write permissions OK"},{"location":"api/sync/#post-test","title":"POST /test","text":"<p>Tests NAS mount access.</p> <p>Response (200): <pre><code>{\n  \"success\": true,\n  \"message\": \"NAS mount accessible for read/write\"\n}\n</code></pre></p> <p>Possible Errors:</p> <pre><code>{\n  \"success\": false,\n  \"message\": \"NAS mount not configured. Define NAS_MOUNT_PATH and mount the SMB share.\"\n}\n</code></pre> <pre><code>{\n  \"success\": false,\n  \"message\": \"Mount path does not exist: /app/nas_backup\"\n}\n</code></pre> <pre><code>{\n  \"success\": false,\n  \"message\": \"Mount is not writable\"\n}\n</code></pre>"},{"location":"api/sync/#post-run","title":"POST /run","text":"<p>Starts synchronization of all pending documents.</p> <p>Response (200): <pre><code>{\n  \"total\": 8,\n  \"synced\": 7,\n  \"failed\": 1,\n  \"errors\": [\n    \"Document 42: Source file not found\"\n  ]\n}\n</code></pre></p> Field Description total Number of documents to synchronize synced Successfully synchronized documents failed Failed documents errors List of detailed errors <p>Errors:</p> Code Description 400 NAS mount not configured or inaccessible"},{"location":"api/sync/#post-documentdocument_id","title":"POST /document/{document_id}","text":"<p>Synchronizes a specific document.</p> <p>Path Parameters:</p> Parameter Type Description document_id int Document ID <p>Response (200): <pre><code>{\n  \"success\": true,\n  \"message\": \"Synchronized to /app/nas_backup/2024/01/invoices/abc.pdf\"\n}\n</code></pre></p> <p>Errors:</p> Code Description 400 NAS mount not configured or document without file 404 Document not found"},{"location":"api/sync/#file-structure-on-nas","title":"File Structure on NAS","text":"<p>Files are organized by year/month/type:</p> <pre><code>/Volumes/NAS/finance/\n\u251c\u2500\u2500 2024/\n\u2502   \u251c\u2500\u2500 01/\n\u2502   \u2502   \u251c\u2500\u2500 invoices/\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 abc123.pdf\n\u2502   \u2502   \u251c\u2500\u2500 receipts/\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 def456.jpg\n\u2502   \u2502   \u2514\u2500\u2500 salaries/\n\u2502   \u2502       \u2514\u2500\u2500 ghi789.pdf\n\u2502   \u251c\u2500\u2500 02/\n\u2502   \u2502   \u2514\u2500\u2500 ...\n\u2502   \u2514\u2500\u2500 ...\n\u251c\u2500\u2500 2025/\n\u2502   \u2514\u2500\u2500 ...\n\u2514\u2500\u2500 2026/\n    \u2514\u2500\u2500 01/\n        \u251c\u2500\u2500 invoices/\n        \u2514\u2500\u2500 receipts/\n</code></pre>"},{"location":"api/sync/#document-type-mapping","title":"Document Type Mapping","text":"Type (DB) NAS Folder receipt receipts invoice invoices payslip salaries other others"},{"location":"api/sync/#technical-operation","title":"Technical Operation","text":""},{"location":"api/sync/#copy-via-shutil","title":"Copy via shutil","text":"<p>Synchronization uses simple Python file copying:</p> <pre><code>import shutil\nimport os\n\n# Create destination directory\nos.makedirs(dest_dir, exist_ok=True)\n\n# Copy file (preserves metadata)\nshutil.copy2(source_path, dest_path)\n</code></pre> <p>Advantages over rsync/SSH:</p> Criterion SSH/rsync SMB (shutil) Configuration Complex (SSH keys) Simple (mount) Authentication SSH key Native SMB credentials Python Code subprocess + rsync shutil.copy2 NAS Compatibility Variable Universal"},{"location":"api/sync/#database-marking","title":"Database Marking","text":"<p>After successful synchronization, the document is updated:</p> <pre><code>UPDATE documents SET\n  synced_to_nas = TRUE,\n  synced_at = NOW()\nWHERE id = ?;\n</code></pre>"},{"location":"api/sync/#example-usage","title":"Example Usage","text":"<pre><code>// Check configuration\nconst config = await sync.getConfig();\nif (!config.configured) {\n  console.log(\"NAS mount not accessible\");\n  return;\n}\n\n// Test access\nconst test = await sync.testConnection();\nif (!test.success) {\n  console.error(\"Failure:\", test.message);\n  return;\n}\n\n// Check status\nconst status = await sync.getStatus();\nconsole.log(`${status.pending} documents pending`);\n\n// Start synchronization\nif (status.pending &gt; 0) {\n  const result = await sync.runSync();\n  console.log(`${result.synced} synced, ${result.failed} failures`);\n}\n</code></pre>"},{"location":"api/sync/#troubleshooting","title":"Troubleshooting","text":"Problem Cause Solution NAS not configured NAS_MOUNT_PATH empty Define variable in .env Path non-existent Mount not performed Mount SMB share on Mac Permission denied Insufficient rights Check SMB permissions Disk space NAS full Free up space \"configured\": true, \"nas_host\": true, \"nas_user\": true, \"nas_path\": true, \"host\": \"SMB Mount\", \"path\": \"/app/nas_backup\", \"path_exists\": true, \"path_writable\": true } <pre><code>| Champ | Description |\n|-------|-------------|\n| configured | Configuration compl\u00e8te et fonctionnelle |\n| nas_host | Compatibilit\u00e9 legacy (toujours true si configur\u00e9) |\n| nas_user | Compatibilit\u00e9 legacy (toujours true si configur\u00e9) |\n| nas_path | Chemin de montage d\u00e9fini |\n| host | \"SMB Mount\" (indication du type) |\n| path | Chemin du montage dans le container |\n| path_exists | Le r\u00e9pertoire existe |\n| path_writable | Permissions d'\u00e9criture OK |\n\n---\n\n### POST /test\n\nTeste l'acc\u00e8s au montage NAS.\n\n**Response (200):**\n```json\n{\n  \"success\": true,\n  \"message\": \"Montage NAS accessible en lecture/\u00e9criture\"\n}\n</code></pre> <p>Erreurs possibles:</p> <pre><code>{\n  \"success\": false,\n  \"message\": \"Montage NAS non configur\u00e9. D\u00e9finissez NAS_MOUNT_PATH et montez le partage SMB.\"\n}\n</code></pre> <pre><code>{\n  \"success\": false,\n  \"message\": \"Le chemin de montage n'existe pas: /app/nas_backup\"\n}\n</code></pre> <pre><code>{\n  \"success\": false,\n  \"message\": \"Le montage n'est pas accessible en \u00e9criture\"\n}\n</code></pre>"},{"location":"api/sync/#post-run_1","title":"POST /run","text":"<p>Lance la synchronisation de tous les documents en attente.</p> <p>Response (200): <pre><code>{\n  \"total\": 8,\n  \"synced\": 7,\n  \"failed\": 1,\n  \"errors\": [\n    \"Document 42: Fichier source introuvable\"\n  ]\n}\n</code></pre></p> Champ Description total Nombre de documents \u00e0 synchroniser synced Documents synchronis\u00e9s avec succ\u00e8s failed Documents en \u00e9chec errors Liste des erreurs d\u00e9taill\u00e9es <p>Erreurs:</p> Code Description 400 Montage NAS non configur\u00e9 ou inaccessible"},{"location":"api/sync/#post-documentdocument_id_1","title":"POST /document/{document_id}","text":"<p>Synchronise un document sp\u00e9cifique.</p> <p>Path Parameters:</p> Param\u00e8tre Type Description document_id int ID du document <p>Response (200): <pre><code>{\n  \"success\": true,\n  \"message\": \"Synchronis\u00e9 vers /app/nas_backup/2024/01/factures/abc.pdf\"\n}\n</code></pre></p> <p>Erreurs:</p> Code Description 400 Montage NAS non configur\u00e9 ou document sans fichier 404 Document non trouv\u00e9"},{"location":"api/sync/#structure-des-fichiers-sur-le-nas","title":"Structure des fichiers sur le NAS","text":"<p>Les fichiers sont organis\u00e9s par ann\u00e9e/mois/type :</p> <pre><code>/Volumes/NAS/finance/\n\u251c\u2500\u2500 2024/\n\u2502   \u251c\u2500\u2500 01/\n\u2502   \u2502   \u251c\u2500\u2500 factures/\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 abc123.pdf\n\u2502   \u2502   \u251c\u2500\u2500 tickets/\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 def456.jpg\n\u2502   \u2502   \u2514\u2500\u2500 salaires/\n\u2502   \u2502       \u2514\u2500\u2500 ghi789.pdf\n\u2502   \u251c\u2500\u2500 02/\n\u2502   \u2502   \u2514\u2500\u2500 ...\n\u2502   \u2514\u2500\u2500 ...\n\u251c\u2500\u2500 2025/\n\u2502   \u2514\u2500\u2500 ...\n\u2514\u2500\u2500 2026/\n    \u2514\u2500\u2500 01/\n        \u251c\u2500\u2500 factures/\n        \u2514\u2500\u2500 tickets/\n</code></pre>"},{"location":"api/sync/#mapping-des-types-de-documents","title":"Mapping des types de documents","text":"Type (BDD) Dossier NAS receipt tickets invoice factures payslip salaires other autres"},{"location":"api/sync/#fonctionnement-technique","title":"Fonctionnement technique","text":""},{"location":"api/sync/#copie-via-shutil","title":"Copie via shutil","text":"<p>La synchronisation utilise une simple copie de fichiers Python :</p> <pre><code>import shutil\nimport os\n\n# Cr\u00e9er le r\u00e9pertoire de destination\nos.makedirs(dest_dir, exist_ok=True)\n\n# Copier le fichier (pr\u00e9serve les m\u00e9tadonn\u00e9es)\nshutil.copy2(source_path, dest_path)\n</code></pre> <p>Avantages par rapport \u00e0 rsync/SSH :</p> Crit\u00e8re SSH/rsync SMB (shutil) Configuration Complexe (cl\u00e9s SSH) Simple (montage) Authentification Cl\u00e9 SSH Identifiants SMB natifs Code Python subprocess + rsync shutil.copy2 Compatibilit\u00e9 NAS Variable Universelle"},{"location":"api/sync/#marquage-en-base","title":"Marquage en base","text":"<p>Apr\u00e8s synchronisation r\u00e9ussie, le document est mis \u00e0 jour :</p> <pre><code>UPDATE documents SET\n  synced_to_nas = TRUE,\n  synced_at = NOW()\nWHERE id = ?;\n</code></pre>"},{"location":"api/sync/#exemple-dutilisation","title":"Exemple d'utilisation","text":"<pre><code>// V\u00e9rifier la configuration\nconst config = await sync.getConfig();\nif (!config.configured) {\n  console.log(\"Montage NAS non accessible\");\n  return;\n}\n\n// Tester l'acc\u00e8s\nconst test = await sync.testConnection();\nif (!test.success) {\n  console.error(\"\u00c9chec:\", test.message);\n  return;\n}\n\n// Voir le statut\nconst status = await sync.getStatus();\nconsole.log(`${status.pending} documents en attente`);\n\n// Lancer la synchronisation\nif (status.pending &gt; 0) {\n  const result = await sync.runSync();\n  console.log(`${result.synced} synchronis\u00e9s, ${result.failed} \u00e9checs`);\n}\n</code></pre>"},{"location":"api/sync/#depannage","title":"D\u00e9pannage","text":"Probl\u00e8me Cause Solution NAS non configur\u00e9 NAS_MOUNT_PATH vide D\u00e9finir la variable dans .env Chemin inexistant Montage non fait Monter le partage SMB sur le Mac Permission refus\u00e9e Droits insuffisants V\u00e9rifier les permissions SMB Espace disque NAS plein Lib\u00e9rer de l'espace"},{"location":"api/tags/","title":"Tags API","text":"<p>Base URL: <code>/api/v1/tags</code></p> <p>Tags allow flexible categorization of documents.</p>"},{"location":"api/tags/#endpoints","title":"Endpoints","text":""},{"location":"api/tags/#get","title":"GET /","text":"<p>Lists all user tags.</p> <p>Response (200): <pre><code>[\n  {\n    \"id\": 1,\n    \"name\": \"Groceries\",\n    \"color\": \"#22c55e\",\n    \"icon\": \"shopping-cart\",\n    \"created_at\": \"2024-01-15T10:30:00Z\"\n  },\n  {\n    \"id\": 2,\n    \"name\": \"Transport\",\n    \"color\": \"#3b82f6\",\n    \"icon\": \"car\",\n    \"created_at\": \"2024-01-15T10:31:00Z\"\n  }\n]\n</code></pre></p>"},{"location":"api/tags/#post","title":"POST /","text":"<p>Creates a new tag.</p> <p>Request Body: <pre><code>{\n  \"name\": \"Leisure\",\n  \"color\": \"#f59e0b\",\n  \"icon\": \"gamepad\"\n}\n</code></pre></p> Field Type Required Description name string Yes Tag name (unique per user) color string Yes Hexadecimal color (#RRGGBB) icon string No Icon name (optional) <p>Response (201): <pre><code>{\n  \"id\": 3,\n  \"name\": \"Leisure\",\n  \"color\": \"#f59e0b\",\n  \"icon\": \"gamepad\",\n  \"created_at\": \"2024-01-15T11:00:00Z\"\n}\n</code></pre></p> <p>Errors:</p> Code Description 400 Tag name already used 422 Invalid data"},{"location":"api/tags/#get-id","title":"GET /{id}","text":"<p>Retrieves a tag by its ID.</p> <p>Response (200): <pre><code>{\n  \"id\": 1,\n  \"name\": \"Groceries\",\n  \"color\": \"#22c55e\",\n  \"icon\": \"shopping-cart\",\n  \"created_at\": \"2024-01-15T10:30:00Z\"\n}\n</code></pre></p>"},{"location":"api/tags/#put-id","title":"PUT /{id}","text":"<p>Updates a tag.</p> <p>Request Body: <pre><code>{\n  \"name\": \"Food\",\n  \"color\": \"#16a34a\"\n}\n</code></pre></p> <p>All fields are optional.</p> <p>Response (200): Tag updated</p>"},{"location":"api/tags/#delete-id","title":"DELETE /{id}","text":"<p>Deletes a tag.</p> <p>Warning</p> <p>Deleting a tag removes it from all associated documents. Budgets linked to this tag are also deleted.</p> <p>Response (204): No Content</p>"},{"location":"api/tags/#suggested-colors","title":"Suggested Colors","text":"Category Color Hex Groceries Green <code>#22c55e</code> Transport Blue <code>#3b82f6</code> Housing Purple <code>#8b5cf6</code> Leisure Orange <code>#f59e0b</code> Health Pink <code>#ec4899</code> Restaurant Red <code>#ef4444</code> Travel Cyan <code>#06b6d4</code> Income Emerald <code>#10b981</code>"},{"location":"api/tags/#suggested-icons","title":"Suggested Icons","text":"<p>Icons are optional and use names from Lucide Icons.</p> Category Icon Groceries <code>shopping-cart</code> Transport <code>car</code> Housing <code>home</code> Leisure <code>gamepad</code> Health <code>heart-pulse</code> Restaurant <code>utensils</code> Travel <code>plane</code> Salary <code>banknote</code>"},{"location":"architecture/backend/","title":"Backend Architecture","text":""},{"location":"architecture/backend/#folder-structure","title":"Folder Structure","text":"<pre><code>backend/\n\u251c\u2500\u2500 app/\n\u2502   \u251c\u2500\u2500 main.py              # FastAPI Entry Point\n\u2502   \u251c\u2500\u2500 core/                # Central Configuration\n\u2502   \u2502   \u251c\u2500\u2500 config.py        # Environment Variables\n\u2502   \u2502   \u251c\u2500\u2500 database.py      # PostgreSQL Connection\n\u2502   \u2502   \u2514\u2500\u2500 security.py      # JWT, bcrypt\n\u2502   \u251c\u2500\u2500 models/              # SQLAlchemy Models\n\u2502   \u2502   \u251c\u2500\u2500 user.py\n\u2502   \u2502   \u251c\u2500\u2500 document.py\n\u2502   \u2502   \u251c\u2500\u2500 item.py\n\u2502   \u2502   \u251c\u2500\u2500 tag.py\n\u2502   \u2502   \u251c\u2500\u2500 budget.py\n\u2502   \u2502   \u2514\u2500\u2500 currency.py\n\u2502   \u251c\u2500\u2500 schemas/             # Pydantic Schemas\n\u2502   \u2502   \u251c\u2500\u2500 user.py\n\u2502   \u2502   \u251c\u2500\u2500 document.py\n\u2502   \u2502   \u251c\u2500\u2500 item.py\n\u2502   \u2502   \u251c\u2500\u2500 tag.py\n\u2502   \u2502   \u251c\u2500\u2500 budget.py\n\u2502   \u2502   \u2514\u2500\u2500 currency.py\n\u2502   \u251c\u2500\u2500 api/\n\u2502   \u2502   \u251c\u2500\u2500 deps.py          # Dependencies (get_db, get_current_user)\n\u2502   \u2502   \u2514\u2500\u2500 routes/          # API Endpoints\n\u2502   \u2502       \u251c\u2500\u2500 auth.py\n\u2502   \u2502       \u251c\u2500\u2500 documents.py\n\u2502   \u2502       \u251c\u2500\u2500 tags.py\n\u2502   \u2502       \u251c\u2500\u2500 budgets.py\n\u2502   \u2502       \u251c\u2500\u2500 items.py\n\u2502   \u2502       \u251c\u2500\u2500 stats.py\n\u2502   \u2502       \u251c\u2500\u2500 currencies.py\n\u2502   \u2502       \u251c\u2500\u2500 export.py\n\u2502   \u2502       \u2514\u2500\u2500 sync.py\n\u2502   \u2514\u2500\u2500 services/            # Business Logic\n\u2502       \u251c\u2500\u2500 ocr_service.py\n\u2502       \u251c\u2500\u2500 ai_service.py\n\u2502       \u251c\u2500\u2500 document_processor.py\n\u2502       \u251c\u2500\u2500 export_service.py\n\u2502       \u251c\u2500\u2500 nas_sync_service.py\n\u2502       \u251c\u2500\u2500 currency_service.py\n\u2502       \u2514\u2500\u2500 pdf_service.py     # New PDF Generation Service\n\u251c\u2500\u2500 alembic/                 # DB Migrations\n\u2502   \u2514\u2500\u2500 versions/\n\u2502       \u2514\u2500\u2500 001_initial_schema.py\n\u251c\u2500\u2500 Dockerfile\n\u2514\u2500\u2500 requirements.txt\n</code></pre>"},{"location":"architecture/backend/#data-models","title":"Data Models","text":""},{"location":"architecture/backend/#user","title":"User","text":"<pre><code>class User(Base):\n    id: int                  # Primary Key\n    email: str               # Unique Email\n    password_hash: str       # Hashed Password (bcrypt)\n    name: str | None         # Display Name\n    created_at: datetime     # Creation Date\n</code></pre>"},{"location":"architecture/backend/#document","title":"Document","text":"<pre><code>class Document(Base):\n    id: int\n    user_id: int             # Owner\n\n    # File\n    file_path: str           # Path on server\n    original_name: str       # Original filename\n    file_type: str           # MIME type\n\n    # Extraction\n    doc_type: str            # receipt, invoice, payslip, other\n    date: date\n    time: time\n    merchant: str\n    location: str\n\n    # Finance\n    total_amount: Decimal\n    currency: str            # ISO Code (EUR, USD...)\n    is_income: bool\n\n    # OCR\n    ocr_raw_text: str        # Raw extracted text\n    ocr_confidence: Decimal  # Confidence score (0-100)\n\n    # Sync\n    synced_to_nas: bool\n    synced_at: datetime\n\n    # Relationships\n    items: List[Item]\n    tags: List[Tag]\n</code></pre>"},{"location":"architecture/backend/#item-articles","title":"Item (Articles)","text":"<pre><code>class Item(Base):\n    id: int\n    document_id: int\n\n    name: str                # Item Name\n    quantity: Decimal        # Quantity\n    unit: str                # Unit (kg, L, piece...)\n    unit_price: Decimal      # Unit Price\n    total_price: Decimal     # Total Price\n    category: str            # Item Category\n</code></pre>"},{"location":"architecture/backend/#services","title":"Services","text":""},{"location":"architecture/backend/#ocrservice-http-client","title":"OCRService (HTTP Client)","text":"<p>HTTP Client to the separate OCR microservice (PaddleOCR in a dedicated container).</p> <pre><code>class OCRService:\n    async def extract_text(self, file_path: str) -&gt; OCRResult:\n        \"\"\"\n        Calls the OCR microservice via HTTP.\n\n        The microservice is accessible at http://ocr-service:5001\n        and uses PaddleOCR for extraction.\n\n        Returns:\n            OCRResult with raw text and confidence score\n        \"\"\"\n        response = await self._client.post(\n            f\"{self.service_url}/ocr\",\n            json={\"file_path\": file_path}\n        )\n        return OCRResult(**response.json())\n</code></pre> <p>Supported formats: - Images: JPG, JPEG, PNG, WEBP, BMP - Documents: PDF (converted to images)</p> <p>Architecture</p> <p>OCR is isolated in a separate microservice (<code>ocr_service/</code>) for:</p> <ul> <li>Isolation of heavy dependencies (PaddleOCR, OpenCV)</li> <li>Independent scalability</li> <li>Separate memory management</li> </ul>"},{"location":"architecture/backend/#aiservice","title":"AIService","text":"<p>Text analysis and structured extraction.</p> <pre><code>class AIService:\n    async def extract_structured_data(self, raw_text: str) -&gt; ExtractionResult:\n        \"\"\"\n        Analyzes OCR text and extracts structured data.\n\n        Uses Ollama/Mistral for analysis.\n\n        Returns:\n            ExtractionResult with all extracted information\n        \"\"\"\n</code></pre>"},{"location":"architecture/backend/#documentprocessor","title":"DocumentProcessor","text":"<p>Complete processing pipeline.</p> <pre><code>class DocumentProcessor:\n    async def process(self, document_id: int) -&gt; Document:\n        \"\"\"\n        Complete pipeline:\n        1. OCR \u2192 Text Extraction\n        2. AI \u2192 Analysis and Structuring\n        3. DB \u2192 Document + Items Update\n        \"\"\"\n</code></pre>"},{"location":"architecture/backend/#pdfreportservice","title":"PDFReportService","text":"<p>PDF report generation service with charts.</p> <p>This service uses <code>ReportLab</code> for PDF document creation and <code>Matplotlib</code> for integrating charts.</p> <pre><code>class PDFReportService:\n    def __init__(self, db: Session, user_id: int):\n        # ...\n\n    def generate_monthly_report(self, year: int, month: int) -&gt; bytes:\n        # ...\n\n    def generate_annual_report(self, year: int) -&gt; bytes:\n        # ...\n\n    def export_chart(self, chart_type: str, params: dict) -&gt; bytes:\n        # ...\n</code></pre>"},{"location":"architecture/backend/#api-routes","title":"API Routes","text":""},{"location":"architecture/backend/#authentication-auth","title":"Authentication (<code>/auth</code>)","text":"Method Endpoint Description POST <code>/register</code> Create account POST <code>/login</code> Log in GET <code>/me</code> User info"},{"location":"architecture/backend/#documents-documents","title":"Documents (<code>/documents</code>)","text":"Method Endpoint Description GET <code>/</code> List documents (with advanced search and filters) POST <code>/upload</code> Upload file GET <code>/{id}</code> Document details PUT <code>/{id}</code> Modify document DELETE <code>/{id}</code> Delete document POST <code>/{id}/reprocess</code> Re-run OCR/AI POST <code>/{id}/tags/{tag_id}</code> Add tag DELETE <code>/{id}/tags/{tag_id}</code> Remove tag"},{"location":"architecture/backend/#tags-tags","title":"Tags (<code>/tags</code>)","text":"Method Endpoint Description GET <code>/</code> List tags POST <code>/</code> Create tag GET <code>/{id}</code> Tag details PUT <code>/{id}</code> Modify tag DELETE <code>/{id}</code> Delete tag"},{"location":"architecture/backend/#budgets-budgets","title":"Budgets (<code>/budgets</code>)","text":"Method Endpoint Description GET <code>/</code> List budgets GET <code>/current</code> Monthly budgets with spending POST <code>/</code> Create budget PUT <code>/{id}</code> Modify budget DELETE <code>/{id}</code> Delete budget"},{"location":"architecture/backend/#statistics-stats","title":"Statistics (<code>/stats</code>)","text":"Method Endpoint Description GET <code>/summary</code> Monthly summary GET <code>/by-tag</code> Spending by tag GET <code>/monthly</code> Monthly evolution GET <code>/top-items</code> Frequent items"},{"location":"architecture/backend/#export-export","title":"Export (<code>/export</code>)","text":"Method Endpoint Description GET <code>/documents/csv</code> Export documents CSV GET <code>/monthly/csv</code> Export monthly summary CSV GET <code>/monthly/pdf</code> Export monthly PDF report GET <code>/annual/pdf</code> Export annual PDF report GET <code>/chart/{chart_type}</code> Export chart PNG"},{"location":"architecture/backend/#synchronization-sync","title":"Synchronization (<code>/sync</code>)","text":"Method Endpoint Description GET <code>/status</code> Sync status GET <code>/config</code> NAS config POST <code>/test</code> Test connection POST <code>/run</code> Run sync POST <code>/document/{id}</code> Sync a document"},{"location":"architecture/backend/#dependencies","title":"Dependencies","text":"<pre><code># DB Session Injection\ndef get_db() -&gt; Generator[Session, None, None]:\n    db = SessionLocal()\n    try:\n        yield db\n    finally:\n        db.close()\n\n# Retrieve user from JWT token\ndef get_current_user(\n    token: str = Depends(oauth2_scheme),\n    db: Session = Depends(get_db)\n) -&gt; User:\n    # Decode token\n    # Retrieve user\n    # Return or raise 401\n</code></pre>"},{"location":"architecture/frontend/","title":"Frontend Architecture","text":""},{"location":"architecture/frontend/#tech-stack","title":"Tech Stack","text":"Technology Version Usage React 18.2 UI Framework TypeScript 5.3 Static Typing Vite 5.0 Build tool Tailwind CSS 3.4 Styling React Router 6.21 Navigation Axios 1.6 HTTP client Recharts 2.10 Charts Lucide React 0.312 Icons"},{"location":"architecture/frontend/#folder-structure","title":"Folder Structure","text":"<pre><code>frontend/src/\n\u251c\u2500\u2500 main.tsx                 # Entry Point\n\u251c\u2500\u2500 App.tsx                  # Main Router\n\u251c\u2500\u2500 types/\n\u2502   \u2514\u2500\u2500 index.ts             # TypeScript Interfaces\n\u251c\u2500\u2500 services/\n\u2502   \u2514\u2500\u2500 api.ts               # Axios Client + Endpoints\n\u251c\u2500\u2500 hooks/\n\u2502   \u251c\u2500\u2500 useAuth.tsx          # Authentication Context\n\u2502   \u2514\u2500\u2500 useDebounce.ts       # Debouncing Hook\n\u251c\u2500\u2500 components/\n\u2502   \u251c\u2500\u2500 Layout.tsx           # Layout with Sidebar\n\u2502   \u251c\u2500\u2500 ProtectedRoute.tsx   # Route Guard\n\u2502   \u251c\u2500\u2500 DocumentFilters.tsx  # Document Filters Panel\n\u2502   \u2514\u2500\u2500 dashboard/           # Dashboard Components\n\u2502       \u251c\u2500\u2500 StatCard.tsx\n\u2502       \u251c\u2500\u2500 MonthlyChart.tsx\n\u2502       \u251c\u2500\u2500 TagPieChart.tsx\n\u2502       \u251c\u2500\u2500 BudgetProgress.tsx\n\u2502       \u251c\u2500\u2500 TopExpenses.tsx\n\u2502       \u2514\u2500\u2500 TopItems.tsx\n\u2514\u2500\u2500 pages/\n    \u251c\u2500\u2500 LoginPage.tsx\n    \u251c\u2500\u2500 RegisterPage.tsx\n    \u251c\u2500\u2500 DashboardPage.tsx\n    \u251c\u2500\u2500 DocumentsPage.tsx\n    \u251c\u2500\u2500 TagsPage.tsx\n    \u251c\u2500\u2500 BudgetsPage.tsx\n    \u2514\u2500\u2500 SettingsPage.tsx\n</code></pre>"},{"location":"architecture/frontend/#typescript-types","title":"TypeScript Types","text":""},{"location":"architecture/frontend/#main-entities","title":"Main Entities","text":"<pre><code>interface User {\n  id: number;\n  email: string;\n  name: string | null;\n  created_at: string;\n}\n\ninterface Document {\n  id: number;\n  file_path: string;\n  original_name: string;\n  doc_type?: 'receipt' | 'invoice' | 'payslip' | 'other';\n  date?: string;\n  merchant?: string;\n  total_amount?: number;\n  currency: string;\n  is_income: boolean;\n  tags: Tag[];\n  items: Item[];\n}\n\ninterface Tag {\n  id: number;\n  name: string;\n  color: string;\n  icon?: string;\n}\n\ninterface Budget {\n  id: number;\n  tag_id: number;\n  month: string;\n  limit_amount: number;\n  currency: string;\n}\n</code></pre>"},{"location":"architecture/frontend/#statistics-types","title":"Statistics Types","text":"<pre><code>interface StatsSummary {\n  month: string;\n  total_expenses: number;\n  total_income: number;\n  balance: number;\n  transaction_count: number;\n}\n\ninterface BudgetWithSpending {\n  id: number;\n  tag_name: string;\n  tag_color: string;\n  limit_amount: number;\n  spent_amount: number;\n  percentage_used: number;\n}\n</code></pre>"},{"location":"architecture/frontend/#api-client","title":"API Client","text":""},{"location":"architecture/frontend/#axios-configuration","title":"Axios Configuration","text":"<pre><code>const apiClient = axios.create({\n  baseURL: 'http://localhost:8000/api/v1',\n  headers: { 'Content-Type': 'application/json' },\n});\n\n// Interceptor: adds JWT token\napiClient.interceptors.request.use((config) =&gt; {\n  const token = localStorage.getItem('finance_manager_token');\n  if (token) {\n    config.headers.Authorization = `Bearer ${token}`;\n  }\n  return config;\n});\n\n// Interceptor: handles 401 errors\napiClient.interceptors.response.use(\n  (response) =&gt; response,\n  (error) =&gt; {\n    if (error.response?.status === 401) {\n      localStorage.removeItem('finance_manager_token');\n      window.location.href = '/login';\n    }\n    return Promise.reject(error);\n  }\n);\n</code></pre>"},{"location":"architecture/frontend/#available-endpoints","title":"Available Endpoints","text":"<pre><code>// Authentication\nauth.register(data: RegisterData): Promise&lt;User&gt;\nauth.login(credentials: LoginCredentials): Promise&lt;AuthResponse&gt;\nauth.getMe(): Promise&lt;User&gt;\n\n// Documents\ndocuments.list(params?): Promise&lt;DocumentListItem[]&gt;\ndocuments.upload(file: File): Promise&lt;Document&gt;\ndocuments.get(id: number): Promise&lt;Document&gt;\ndocuments.update(id: number, data): Promise&lt;Document&gt;\ndocuments.delete(id: number): Promise&lt;void&gt;\n\n// Tags\ntags.list(): Promise&lt;Tag[]&gt;\ntags.create(data: TagCreate): Promise&lt;Tag&gt;\ntags.update(id: number, data: TagUpdate): Promise&lt;Tag&gt;\ntags.delete(id: number): Promise&lt;void&gt;\n\n// Budgets\nbudgets.list(params?): Promise&lt;Budget[]&gt;\nbudgets.getCurrent(month?: string): Promise&lt;BudgetWithSpending[]&gt;\nbudgets.create(data: BudgetCreate): Promise&lt;Budget&gt;\nbudgets.update(id: number, data: BudgetUpdate): Promise&lt;Budget&gt;\nbudgets.delete(id: number): Promise&lt;void&gt;\n\n// Statistics\nstats.getSummary(month?: string): Promise&lt;StatsSummary&gt;\nstats.getByTag(month?: string): Promise&lt;StatsByTag[]&gt;\nstats.getMonthly(months?: number): Promise&lt;MonthlyStats[]&gt;\nstats.getTopItems(params?): Promise&lt;TopItem[]&gt;\n\n// Synchronization\nsync.getStatus(): Promise&lt;SyncStatus&gt;\nsync.testConnection(): Promise&lt;SyncResult&gt;\nsync.runSync(): Promise&lt;SyncRunResult&gt;\n\n// Export\nexportApi.documentsCSV(params?): Promise&lt;void&gt;\nexportApi.monthlyCSV(year: number, month: number): Promise&lt;void&gt;\nexportApi.monthlyPDF(year: number, month: number): Promise&lt;void&gt;\nexportApi.annualPDF(year: number): Promise&lt;void&gt;\nexportApi.exportChart(chartType: ChartType, month?: string): Promise&lt;void&gt;\n</code></pre>"},{"location":"architecture/frontend/#components","title":"Components","text":""},{"location":"architecture/frontend/#layout","title":"Layout","text":"<p>The main layout with responsive sidebar:</p> <pre><code>&lt;Layout&gt;\n  &lt;Sidebar&gt;\n    &lt;Logo /&gt;\n    &lt;Navigation /&gt;\n    &lt;UserInfo /&gt;\n  &lt;/Sidebar&gt;\n  &lt;Main&gt;\n    &lt;Header /&gt;\n    &lt;Content&gt;{children}&lt;/Content&gt;\n  &lt;/Main&gt;\n&lt;/Layout&gt;\n</code></pre>"},{"location":"architecture/frontend/#protectedroute","title":"ProtectedRoute","text":"<p>Component that protects authenticated routes:</p> <pre><code>&lt;ProtectedRoute&gt;\n  &lt;DashboardPage /&gt;\n&lt;/ProtectedRoute&gt;\n</code></pre> <p>If the user is not logged in, they are redirected to <code>/login</code>.</p>"},{"location":"architecture/frontend/#dashboard-components","title":"Dashboard Components","text":"Component Description <code>StatCard</code> Statistic card with icon and value <code>MonthlyChart</code> Bar chart of expenses/income <code>TagPieChart</code> Donut chart of category breakdown <code>BudgetProgress</code> Budget progress bars <code>TopExpenses</code> List of latest expenses <code>TopItems</code> Most frequent items"},{"location":"architecture/frontend/#important-frontend-pages","title":"Important Frontend Pages","text":"<ul> <li><code>SettingsPage.tsx</code>: This page has been extended to include new user interfaces for exporting monthly and annual PDF reports, as well as exporting individual charts in PNG format. It allows users to choose periods and chart types for their exports.</li> </ul>"},{"location":"architecture/frontend/#authentication","title":"Authentication","text":""},{"location":"architecture/frontend/#auth-context","title":"Auth Context","text":"<pre><code>const AuthContext = createContext&lt;AuthContextType&gt;(null);\n\nexport function AuthProvider({ children }) {\n  const [user, setUser] = useState&lt;User | null&gt;(null);\n  const [isLoading, setIsLoading] = useState(true);\n\n  // Checks token on startup\n  useEffect(() =&gt; {\n    const token = getToken();\n    if (token) {\n      auth.getMe().then(setUser).catch(() =&gt; removeToken());\n    }\n    setIsLoading(false);\n  }, []);\n\n  const login = async (credentials) =&gt; {\n    const response = await auth.login(credentials);\n    setToken(response.access_token);\n    const user = await auth.getMe();\n    setUser(user);\n  };\n\n  const logout = () =&gt; {\n    removeToken();\n    setUser(null);\n  };\n\n  return (\n    &lt;AuthContext.Provider value={{ user, login, logout, isLoading }}&gt;\n      {children}\n    &lt;/AuthContext.Provider&gt;\n  );\n}\n</code></pre>"},{"location":"architecture/frontend/#usage","title":"Usage","text":"<pre><code>function MyComponent() {\n  const { user, logout, isAuthenticated } = useAuth();\n\n  if (!isAuthenticated) {\n    return &lt;Navigate to=\"/login\" /&gt;;\n  }\n\n  return (\n    &lt;div&gt;\n      &lt;p&gt;Hello {user.name}&lt;/p&gt;\n      &lt;button onClick={logout}&gt;Logout&lt;/button&gt;\n    }\n  );\n}\n</code></pre>"},{"location":"architecture/frontend/#styling","title":"Styling","text":""},{"location":"architecture/frontend/#tailwind-css","title":"Tailwind CSS","text":"<p>Main utility classes:</p> <pre><code>// Card\n&lt;div className=\"bg-white rounded-xl shadow-sm border border-gray-100 p-6\"&gt;\n\n// Primary button\n&lt;button className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700\"&gt;\n\n// Secondary button\n&lt;button className=\"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50\"&gt;\n\n// Badge/Tag\n&lt;span className=\"px-2 py-1 rounded-full text-xs font-medium\"\n      style={{ backgroundColor: tag.color }}&gt;\n</code></pre>"},{"location":"architecture/frontend/#color-palette","title":"Color Palette","text":"Usage Color Primary <code>blue-600</code> Success <code>green-500</code> Warning <code>amber-500</code> Danger <code>red-500</code> Background <code>slate-50</code> Cards <code>white</code>"},{"location":"architecture/overview/","title":"Architecture Overview","text":""},{"location":"architecture/overview/#global-architecture","title":"Global Architecture","text":"<p>Finance Manager is a modern web application with a microservices architecture:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                              FRONTEND                                    \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n\u2502  \u2502                      React 18 + Vite                            \u2502     \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502     \u2502\n\u2502  \u2502  \u2502Dashboard\u2502 \u2502Documents\u2502 \u2502  Tags   \u2502 \u2502 Budgets \u2502 \u2502Settings \u2502  \u2502     \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502     \u2502\n\u2502  \u2502                           \u2502                                     \u2502     \u2502\n\u2502  \u2502                     \u250c\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2510                              \u2502     \u2502\n\u2502  \u2502                     \u2502  API.ts   \u2502  Axios + JWT                 \u2502     \u2502\n\u2502  \u2502                     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                              \u2502     \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2502 REST API (:3000 \u2192 :8000)\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                              BACKEND                                     \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n\u2502  \u2502                      FastAPI (:8000)                            \u2502     \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502     \u2502\n\u2502  \u2502  \u2502                     Routes API                           \u2502   \u2502     \u2502\n\u2502  \u2502  \u2502  /auth  /documents  /tags  /budgets  /stats  /sync      \u2502   \u2502     \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502     \u2502\n\u2502  \u2502                           \u2502                                     \u2502     \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502     \u2502\n\u2502  \u2502  \u2502                      Services                            \u2502   \u2502     \u2502\n\u2502  \u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502   \u2502     \u2502\n\u2502  \u2502  \u2502  \u2502OCR Client\u2502 \u2502AI Service\u2502 \u2502  Export  \u2502 \u2502 NAS Sync \u2502   \u2502   \u2502     \u2502\n\u2502  \u2502  \u2502  \u2502  (HTTP)  \u2502 \u2502  (HTTP)  \u2502 \u2502   (CSV)  \u2502 \u2502  (SMB)   \u2502   \u2502   \u2502     \u2502\n\u2502  \u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518   \u2502   \u2502     \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502     \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n              \u2502            \u2502                          \u2502\n              \u2502 HTTP :5001 \u2502 HTTP :11434              \u2502 Copie fichiers\n              \u25bc            \u25bc                          \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  OCR SERVICE    \u2502 \u2502     OLLAMA      \u2502    \u2502      STOCKAGE               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502 \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502    \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502 PaddleOCR \u2502  \u2502 \u2502  \u2502  Mistral  \u2502  \u2502    \u2502  \u2502PostgreSQL\u2502 \u2502    NAS    \u2502 \u2502\n\u2502  \u2502  (Flask)  \u2502  \u2502 \u2502  \u2502    7B     \u2502  \u2502    \u2502  \u2502   :5432  \u2502 \u2502  (SMB)    \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502 \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502    \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502     :5001       \u2502 \u2502     :11434      \u2502    \u2502                             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"architecture/overview/#docker-services","title":"Docker Services","text":"Service Port Image Description <code>frontend</code> 3000 Node 20 React + Vite Application <code>backend</code> 8000 Python 3.11 FastAPI API <code>postgres</code> 5432 postgres:15-alpine Database <code>ollama</code> 11434 ollama/ollama LLM Server (Mistral) <code>ocr-service</code> 5001 Python 3.11 OCR Microservice (PaddleOCR)"},{"location":"architecture/overview/#inter-service-communication","title":"Inter-service Communication","text":""},{"location":"architecture/overview/#backend-ocr-service","title":"Backend \u2194 OCR Service","text":"<p>The backend communicates with the OCR microservice via HTTP:</p> <pre><code># backend/app/services/ocr_service.py\nasync def extract_text(self, file_path: str) -&gt; OCRResult:\n    response = await client.post(\n        f\"{self.ocr_service_url}/ocr\",\n        json={\"file_path\": file_path}\n    )\n    return OCRResult(**response.json())\n</code></pre>"},{"location":"architecture/overview/#backend-ollama","title":"Backend \u2194 Ollama","text":"<p>The backend communicates with Ollama via its REST API:</p> <pre><code># backend/app/services/ai_service.py\nresponse = await client.post(\n    f\"{self.host}/api/generate\",\n    json={\"model\": \"mistral\", \"prompt\": prompt}\n)\n</code></pre>"},{"location":"architecture/overview/#backend-nas","title":"Backend \u2194 NAS","text":"<p>Synchronization uses an SMB mount (no SSH/rsync):</p> <pre><code># backend/app/services/nas_sync_service.py\n# Simple file copy to the SMB mount\nshutil.copy2(document.file_path, dest_path)\n</code></pre>"},{"location":"architecture/overview/#data-flow","title":"Data Flow","text":""},{"location":"architecture/overview/#document-upload","title":"Document Upload","text":"<pre><code>sequenceDiagram\n    participant U as User\n    participant F as Frontend\n    participant B as Backend\n    participant OCR as OCR Service\n    participant AI as Ollama\n    participant D as PostgreSQL\n\n    U-&gt;&gt;F: Upload file\n    F-&gt;&gt;B: POST /documents/upload\n    B-&gt;&gt;D: Create Document\n    B-&gt;&gt;OCR: POST /ocr (file_path)\n    OCR--&gt;&gt;B: {text, confidence}\n    B-&gt;&gt;D: Save OCR text\n    B-&gt;&gt;AI: POST /api/generate (prompt + text)\n    AI--&gt;&gt;B: Structured JSON\n    B-&gt;&gt;D: Update Document + create Items\n    B--&gt;&gt;F: Complete Document\n    F--&gt;&gt;U: Display result\n</code></pre>"},{"location":"architecture/overview/#nas-synchronization","title":"NAS Synchronization","text":"<pre><code>sequenceDiagram\n    participant U as User\n    participant B as Backend\n    participant NAS as SMB Mount\n\n    U-&gt;&gt;B: POST /sync/run\n    B-&gt;&gt;B: Retrieve unsynced documents\n    loop For each document\n        B-&gt;&gt;NAS: shutil.copy2(src, dest)\n        Note over NAS: Structure: year/month/type/\n        B-&gt;&gt;B: synced_to_nas = true\n    end\n    B--&gt;&gt;U: {synced: N, failed: M}\n</code></pre>"},{"location":"architecture/overview/#data-model","title":"Data Model","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502     User     \u2502       \u2502   Document   \u2502       \u2502     Item     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524       \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524       \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 id           \u2502\u2500\u2500\u2510    \u2502 id           \u2502\u2500\u2500\u2510    \u2502 id           \u2502\n\u2502 email        \u2502  \u2502    \u2502 user_id      \u2502  \u2502    \u2502 document_id  \u2502\n\u2502 password_hash\u2502  \u2514\u2500\u2500\u2500&gt;\u2502 file_path    \u2502  \u2514\u2500\u2500\u2500&gt;\u2502 name         \u2502\n\u2502 name         \u2502       \u2502 date         \u2502       \u2502 quantity     \u2502\n\u2502 created_at   \u2502       \u2502 merchant     \u2502       \u2502 unit_price   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2502 total_amount \u2502       \u2502 total_price  \u2502\n                       \u2502 currency     \u2502       \u2502 category     \u2502\n                       \u2502 is_income    \u2502       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                       \u2502 ocr_raw_text \u2502\n                       \u2502 ocr_confidence\u2502\n                       \u2502 synced_to_nas\u2502\n                       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2502\n                              \u2502 Many-to-Many\n                              \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502     Tag      \u2502&lt;\u2500\u2500\u2500\u2500\u2500\u2500\u2502 DocumentTag  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524       \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 id           \u2502       \u2502 document_id  \u2502\n\u2502 user_id      \u2502       \u2502 tag_id       \u2502\n\u2502 name         \u2502       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u2502 color        \u2502\n\u2502 icon         \u2502       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2502    Budget    \u2502\n       \u2502               \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500&gt;\u2502 id           \u2502\n                       \u2502 user_id      \u2502\n                       \u2502 tag_id       \u2502\n                       \u2502 month        \u2502\n                       \u2502 limit_amount \u2502\n                       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"architecture/overview/#security","title":"Security","text":""},{"location":"architecture/overview/#authentication","title":"Authentication","text":"<ul> <li>JWT (JSON Web Tokens) with HS256 algorithm</li> <li>Tokens valid for 7 days by default</li> <li>Stored in localStorage on the frontend</li> </ul>"},{"location":"architecture/overview/#authorization","title":"Authorization","text":"<ul> <li>Each resource is linked to a <code>user_id</code></li> <li>Systematic verification in routes</li> <li>No access to other users' data</li> </ul>"},{"location":"architecture/overview/#data-protection","title":"Data Protection","text":"<ul> <li>Passwords hashed with bcrypt</li> <li>Input validation with Pydantic</li> <li>SQL escaping with SQLAlchemy</li> </ul>"},{"location":"architecture/overview/#configuration","title":"Configuration","text":""},{"location":"architecture/overview/#environment-variables","title":"Environment Variables","text":"<pre><code># Security\nSECRET_KEY=your-super-secret-key\n\n# Database\nDATABASE_URL=postgresql://finance:finance@postgres:5432/finance_db\n\n# Internal Services\nOLLAMA_HOST=http://ollama:11434\nOLLAMA_MODEL=mistral\nOCR_SERVICE_URL=http://ocr-service:5001\n\n# NAS (SMB mount)\nNAS_LOCAL_PATH=/Volumes/NAS/finance\nNAS_MOUNT_PATH=/app/nas_backup\n</code></pre>"},{"location":"getting-started/configuration/","title":"Configuration","text":""},{"location":"getting-started/configuration/#environment-variables","title":"Environment Variables","text":""},{"location":"getting-started/configuration/#env-file","title":"<code>.env</code> file","text":"<p>The <code>.env</code> file at the root of the project contains all configurations:</p> <pre><code># ===========================================\n# Security\n# ===========================================\n\n# Secret key for signing JWT tokens\n# IMPORTANT: Change this value in production!\nSECRET_KEY=your-super-secret-key-change-this-in-production\n\n# ===========================================\n# Database\n# ===========================================\n\n# PostgreSQL connection URL\n# Format: postgresql://user:password@host:port/database\nDATABASE_URL=postgresql://finance:finance@postgres:5432/finance_db\n\n# ===========================================\n# Ollama (AI)\n# ===========================================\n\n# Ollama service URL\nOLLAMA_HOST=http://ollama:11434\n\n# Model to use for extraction\n# Options: mistral, llama2, codellama, etc.\nOLLAMA_MODEL=mistral\n\n# ===========================================\n# NAS Synchronization (optional)\n# ===========================================\n\n# SMB mount path on the host Mac\nNAS_LOCAL_PATH=/Volumes/NAS/finance\n\n# Path in the Docker container (mounted via volume)\nNAS_MOUNT_PATH=/app/nas_backup\n</code></pre>"},{"location":"getting-started/configuration/#nas-configuration","title":"NAS Configuration","text":""},{"location":"getting-started/configuration/#prerequisites","title":"Prerequisites","text":"<ol> <li>SMB/CIFS share enabled on your NAS</li> <li>Dedicated user with write permissions on the finance folder</li> </ol>"},{"location":"getting-started/configuration/#smb-mount-on-macos","title":"SMB Mount on macOS","text":"<pre><code># Create mount point\nsudo mkdir -p /Volumes/NAS\n\n# Mount SMB share\nmount -t smbfs //username:password@NAS-IP/share /Volumes/NAS\n\n# Or via Finder: Cmd+K \u2192 smb://NAS-IP/share\n</code></pre>"},{"location":"getting-started/configuration/#docker-configuration","title":"Docker Configuration","text":"<p>The SMB mount must be accessible by Docker. In <code>docker compose.yml</code>:</p> <pre><code>backend:\n  volumes:\n    - ${NAS_LOCAL_PATH:-./nas_backup}:/app/nas_backup\n  environment:\n    - NAS_MOUNT_PATH=${NAS_MOUNT_PATH:-}\n</code></pre>"},{"location":"getting-started/configuration/#nas-folder-structure","title":"NAS Folder Structure","text":"<p>Files are organized by year/month/type:</p> <pre><code>/Volumes/NAS/finance/\n\u251c\u2500\u2500 2024/\n\u2502   \u251c\u2500\u2500 01/\n\u2502   \u2502   \u251c\u2500\u2500 invoices/\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 abc123.pdf\n\u2502   \u2502   \u251c\u2500\u2500 receipts/\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 def456.jpg\n\u2502   \u2502   \u2514\u2500\u2500 salaries/\n\u2502   \u2502       \u2514\u2500\u2500 ghi789.pdf\n\u2502   \u2514\u2500\u2500 02/\n\u2502       \u2514\u2500\u2500 ...\n\u251c\u2500\u2500 2025/\n\u2502   \u2514\u2500\u2500 ...\n\u2514\u2500\u2500 2026/\n    \u2514\u2500\u2500 ...\n</code></pre>"},{"location":"getting-started/configuration/#automatic-mounting-optional","title":"Automatic Mounting (optional)","text":"<p>To mount automatically on Mac startup, add to <code>/etc/fstab</code>:</p> <pre><code>//user:pass@nas-ip/share /Volumes/NAS smbfs 0 0\n</code></pre>"},{"location":"getting-started/configuration/#budget-configuration","title":"Budget Configuration","text":""},{"location":"getting-started/configuration/#creating-a-budget","title":"Creating a Budget","text":"<ol> <li>First, create tags corresponding to your categories</li> <li>Go to Budgets &gt; New Budget</li> <li>Select the tag and set the monthly limit</li> </ol>"},{"location":"getting-started/configuration/#visual-alerts","title":"Visual Alerts","text":"Usage Percentage Color Meaning 0-50% Green All good 50-75% Yellow Warning 75-90% Orange Close to limit 90%+ Red Limit exceeded"},{"location":"getting-started/configuration/#frontend-configuration","title":"Frontend Configuration","text":""},{"location":"getting-started/configuration/#frontendenv-file","title":"<code>frontend/.env</code> file","text":"<pre><code># Backend API URL\nVITE_API_URL=http://localhost:8000/api/v1\n</code></pre>"},{"location":"getting-started/configuration/#production-build","title":"Production Build","text":"<pre><code>cd frontend\nnpm run build\n</code></pre> <p>Static files are generated in <code>frontend/dist/</code>.</p>"},{"location":"getting-started/configuration/#customization","title":"Customization","text":""},{"location":"getting-started/configuration/#modify-default-currencies","title":"Modify default currencies","text":"<p>Edit the migration <code>backend/alembic/versions/001_initial_schema.py</code> before the first execution to modify currencies:</p> <pre><code>currencies = [\n    {\"code\": \"EUR\", \"name\": \"Euro\", \"symbol\": \"\u20ac\", \"rate_to_eur\": 1.0},\n    {\"code\": \"USD\", \"name\": \"US Dollar\", \"symbol\": \"$\", \"rate_to_eur\": 0.92},\n    # Add your currencies here\n]\n</code></pre>"},{"location":"getting-started/configuration/#modify-ai-prompt","title":"Modify AI Prompt","text":"<p>The extraction prompt is in <code>backend/app/services/ai_service.py</code>. You can adapt it to improve extraction based on your document types.</p>"},{"location":"getting-started/installation/","title":"Installation","text":""},{"location":"getting-started/installation/#prerequisites","title":"Prerequisites","text":"<ul> <li>Docker and Docker Compose installed</li> <li>Mac M1/M2 or Linux (ARM64 or AMD64 architecture)</li> <li>At least 8 GB RAM (for Ollama)</li> <li>10 GB disk space (AI models + data)</li> </ul>"},{"location":"getting-started/installation/#installation-with-docker","title":"Installation with Docker","text":""},{"location":"getting-started/installation/#1-clone-the-project","title":"1. Clone the Project","text":"<pre><code>git clone &lt;repository-url&gt;\ncd gestionnaireDeFinance\n</code></pre>"},{"location":"getting-started/installation/#2-configure-the-environment","title":"2. Configure the Environment","text":"<pre><code># Copy example file\ncp .env.example .env\n\n# Edit variables (optional)\nnano .env\n</code></pre> <p>Important variables:</p> Variable Description Default <code>SECRET_KEY</code> Secret JWT key Change in production <code>DATABASE_URL</code> PostgreSQL URL Configured for Docker <code>OLLAMA_MODEL</code> LLM Model <code>mistral</code> <code>NAS_HOST</code> NAS IP Empty (optional)"},{"location":"getting-started/installation/#3-launch-services","title":"3. Launch Services","text":"<pre><code># Start all services\ndocker compose up -d\n\n# View logs\ndocker compose logs -f\n</code></pre>"},{"location":"getting-started/installation/#4-initialize-database","title":"4. Initialize Database","text":"<pre><code># Run migrations\ndocker compose exec backend alembic upgrade head\n</code></pre>"},{"location":"getting-started/installation/#5-download-ai-model","title":"5. Download AI Model","text":"<pre><code># Download Mistral (3.8 GB)\ndocker compose exec ollama ollama pull mistral\n</code></pre> <p>First Download</p> <p>Model download may take several minutes depending on your connection.</p>"},{"location":"getting-started/installation/#verification","title":"Verification","text":""},{"location":"getting-started/installation/#service-access","title":"Service Access","text":"Service URL Description Frontend http://localhost:3000 User Interface Backend http://localhost:8000 REST API Swagger http://localhost:8000/docs API Documentation Ollama http://localhost:11434 LLM API"},{"location":"getting-started/installation/#api-test","title":"API Test","text":"<pre><code># Check if API is responding\ncurl http://localhost:8000/health\n\n# Expected response\n{\"status\": \"healthy\"}\n</code></pre>"},{"location":"getting-started/installation/#useful-commands","title":"Useful Commands","text":"<pre><code># Stop services\ndocker compose down\n\n# Rebuild images\ndocker compose build --no-cache\n\n# View container status\ndocker compose ps\n\n# Access backend shell\ndocker compose exec backend bash\n\n# View service logs\ndocker compose logs -f backend\n</code></pre>"},{"location":"getting-started/installation/#troubleshooting","title":"Troubleshooting","text":""},{"location":"getting-started/installation/#postgresql-connection-error","title":"PostgreSQL Connection Error","text":"<pre><code># Check if postgres is running\ndocker compose ps postgres\n\n# Recreate container if necessary\ndocker compose rm -f postgres\ndocker compose up -d postgres\n</code></pre>"},{"location":"getting-started/installation/#ollama-not-responding","title":"Ollama Not Responding","text":"<pre><code># Check logs\ndocker compose logs ollama\n\n# Is the model downloaded?\ndocker compose exec ollama ollama list\n</code></pre>"},{"location":"getting-started/installation/#slow-ocr-on-mac-m1","title":"Slow OCR on Mac M1","text":"<p>PaddleOCR uses the CPU by default. Performance is acceptable but not optimal. For complex documents, allow a few seconds for processing.</p>"},{"location":"services/ai/","title":"AI Service","text":"<p>The AI service uses Ollama with the Mistral model to analyze OCR text and extract structured data.</p>"},{"location":"services/ai/#source-file","title":"Source File","text":"<p><code>backend/app/services/ai_service.py</code></p>"},{"location":"services/ai/#features","title":"Features","text":"<ul> <li>Analysis of raw text extracted by OCR</li> <li>Structured information extraction</li> <li>Automatic document type categorization</li> <li>Identification of individual items</li> </ul>"},{"location":"services/ai/#classes","title":"Classes","text":""},{"location":"services/ai/#extractionresult","title":"ExtractionResult","text":"<p>AI extraction result.</p> <pre><code>@dataclass\nclass ExtractionResult:\n    doc_type: str           # receipt, invoice, payslip, other\n    date: date | None\n    time: time | None\n    merchant: str | None\n    location: str | None\n    items: list[ExtractedItem]\n    total_amount: Decimal | None\n    currency: str\n    is_income: bool\n    confidence: float\n</code></pre>"},{"location":"services/ai/#extracteditem","title":"ExtractedItem","text":"<p>Item extracted from a document.</p> <pre><code>@dataclass\nclass ExtractedItem:\n    name: str\n    quantity: Decimal\n    unit: str | None\n    unit_price: Decimal | None\n    total_price: Decimal | None\n    category: str | None\n</code></pre>"},{"location":"services/ai/#aiservice","title":"AIService","text":"<p>Main analysis service.</p> <pre><code>class AIService:\n    def __init__(self):\n        \"\"\"Initializes the Ollama client.\"\"\"\n        self.client = httpx.AsyncClient(\n            base_url=settings.ollama_host,\n            timeout=120.0\n        )\n        self.model = settings.ollama_model\n\n    async def extract_structured_data(self, raw_text: str) -&gt; ExtractionResult:\n        \"\"\"\n        Analyzes OCR text and extracts data.\n\n        Args:\n            raw_text: Raw text from OCR\n\n        Returns:\n            ExtractionResult with all extracted data\n        \"\"\"\n</code></pre>"},{"location":"services/ai/#extraction-prompt","title":"Extraction Prompt","text":"<p>The prompt used for extraction:</p> <pre><code>You are an assistant specialized in financial document analysis.\nAnalyze the following text extracted by OCR from a document and return the information in JSON format.\n\nThe JSON must contain:\n- doc_type: \"receipt\" | \"invoice\" | \"payslip\" | \"other\"\n- date: \"YYYY-MM-DD\" or null\n- time: \"HH:MM:SS\" or null\n- merchant: name of the business/company or null\n- location: address/city or null\n- items: list of items [{ name, quantity, unit, unit_price, total_price, category }]\n- total_amount: total amount or null\n- currency: currency code (EUR, USD...) default EUR\n- is_income: true if it's income (salary, refund...), false otherwise\n\nText to analyze:\n{raw_text}\n\nRespond ONLY with the JSON, without text before or after.\n</code></pre>"},{"location":"services/ai/#usage","title":"Usage","text":"<pre><code>from app.services.ai_service import get_ai_service\n\n# Get a service instance\nai = get_ai_service()\n\n# Analyze OCR text\nresult = await ai.extract_structured_data(\"\"\"\nCARREFOUR\nParis 15e\n15/01/2024 14:30\n\nGolden Apples 1.5kg    4.49\nBaguette x2            2.40\nMilk 1L                1.10\n\nTOTAL                  7.99\nCB ****1234\n\"\"\")\n\nprint(f\"Merchant: {result.merchant}\")  # Carrefour\nprint(f\"Total: {result.total_amount}\")  # 7.99\nprint(f\"Items: {len(result.items)}\")  # 3\n</code></pre>"},{"location":"services/ai/#configuration","title":"Configuration","text":""},{"location":"services/ai/#environment-variables","title":"Environment Variables","text":"<pre><code>OLLAMA_HOST=http://ollama:11434\nOLLAMA_MODEL=mistral\n</code></pre>"},{"location":"services/ai/#supported-models","title":"Supported Models","text":"Model Size Performance Notes mistral 4.1 GB Excellent Recommended llama2 3.8 GB Good Alternative phi 1.6 GB Correct Lightweight"},{"location":"services/ai/#error-handling","title":"Error Handling","text":"<pre><code>try:\n    result = await ai.extract_structured_data(text)\nexcept httpx.ConnectError:\n    # Ollama not accessible\nexcept httpx.TimeoutException:\n    # Timeout (&gt;2 min)\nexcept json.JSONDecodeError:\n    # Non-JSON response from model\n</code></pre>"},{"location":"services/ai/#fallback","title":"Fallback","text":"<p>If AI fails, the service returns a minimal result:</p> <pre><code>ExtractionResult(\n    doc_type=\"other\",\n    items=[],\n    currency=\"EUR\",\n    is_income=False,\n    confidence=0.0\n)\n</code></pre> <p>The document is still created with the raw OCR text, allowing for later manual correction.</p>"},{"location":"services/ai/#performance","title":"Performance","text":"Document Type Average Time Accuracy Simple Receipt 3-5s 90%+ Complex Invoice 5-10s 85%+ Pay Stub 8-15s 80%+"},{"location":"services/ai/#improving-results","title":"Improving Results","text":""},{"location":"services/ai/#text-preprocessing","title":"Text Preprocessing","text":"<pre><code>def preprocess_ocr_text(text: str) -&gt; str:\n    \"\"\"Cleans OCR text before analysis.\"\"\"\n    # Remove multiple empty lines\n    text = re.sub(r'\\n{3,}', '\\n\\n', text)\n    # Correct multiple spaces\n    text = re.sub(r' {2,}', ' ', text)\n    return text.strip()\n</code></pre>"},{"location":"services/ai/#post-processing","title":"Post-processing","text":"<p>After extraction, validations are applied:</p> <ul> <li>Impossible dates corrected (e.g., 32/01 \u2192 null)</li> <li>Negative amounts flagged</li> <li>Unrecognized currencies \u2192 EUR by default</li> </ul>"},{"location":"services/export/","title":"Export and Report Services","text":"<p>This module gathers backend services for exporting data in different formats (CSV, PDF) and generating reports with charts.</p>"},{"location":"services/export/#source-files","title":"Source Files","text":"<ul> <li><code>backend/app/services/export_service.py</code></li> <li><code>backend/app/services/pdf_service.py</code></li> </ul>"},{"location":"services/export/#features","title":"Features","text":"<ul> <li>Export documents as CSV</li> <li>Export monthly summary as CSV</li> <li>Generate monthly PDF reports with charts</li> <li>Generate annual PDF reports with charts</li> <li>Export individual charts as PNG</li> <li>Filtering by dates, tags (for CSV)</li> <li>Option to include item details (for CSV)</li> </ul>"},{"location":"services/export/#exportservice-class","title":"ExportService Class","text":"<pre><code>class ExportService:\n    def __init__(self, db: Session, user_id: int):\n        \"\"\"\n        Initializes the export service.\n\n        Args:\n            db: Database session\n            user_id: User ID (filters data)\n        \"\"\"\n\n    def export_documents_csv(\n        self,\n        start_date: date | None = None,\n        end_date: date | None = None,\n        tag_ids: list[int] | None = None,\n        include_items: bool = False\n    ) -&gt; str:\n        \"\"\"\n        Exports documents as CSV.\n\n        Returns:\n            CSV content as a string\n        \"\"\"\n\n    def export_monthly_summary_csv(\n        self,\n        year: int,\n        month: int\n    ) -&gt; str:\n        \"\"\"\n        Exports the monthly summary as CSV.\n\n        Returns:\n            CSV content with totals and breakdown\n        \"\"\"\n</code></pre>"},{"location":"services/export/#pdfreportservice-class","title":"PDFReportService Class","text":"<p>The <code>PDFReportService</code> is responsible for generating detailed PDF reports and exporting individual charts in PNG format. It uses <code>ReportLab</code> for PDF layout and <code>Matplotlib</code> to create data visualizations.</p> <pre><code>import matplotlib.pyplot as plt\nimport matplotlib\nmatplotlib.use('Agg') # Using non-GUI backend\nfrom io import BytesIO\n\nfrom reportlab.lib.pagesizes import A4\nfrom reportlab.platypus import SimpleDocTemplate, Image, Table, Paragraph\nfrom reportlab.lib.styles import getSampleStyleSheet\n\nclass PDFReportService:\n    def __init__(self, db: Session, user_id: int):\n        \"\"\"\n        Initializes the PDF report service.\n\n        Args:\n            db: Database session\n            user_id: User ID (filters data)\n        \"\"\"\n\n    def generate_monthly_report(self, year: int, month: int) -&gt; bytes:\n        \"\"\"\n        Generates a complete monthly financial report in PDF with charts.\n\n        Returns:\n            PDF file content as bytes.\n        \"\"\"\n\n    def generate_annual_report(self, year: int) -&gt; bytes:\n        \"\"\"\n        Generates a complete annual financial report in PDF with charts.\n\n        Returns:\n            PDF file content as bytes.\n        \"\"\"\n\n    def export_chart(self, chart_type: str, params: dict) -&gt; bytes:\n        \"\"\"\n        Exports an individual chart (pie, bar, line, donut, area) as PNG.\n\n        Args:\n            chart_type: Type of chart to generate.\n            params: Chart-specific parameters (e.g., 'month').\n\n        Returns:\n            PNG file content as bytes.\n        \"\"\"\n</code></pre>"},{"location":"services/export/#usage","title":"Usage","text":"<pre><code>from app.services.export_service import get_export_service\nfrom app.services.pdf_service import get_pdf_service\n\n# Create services\nexport_service = get_export_service(db, user_id=1)\npdf_service = get_pdf_service(db, user_id=1)\n\n# Export documents CSV\ncsv_content = export_service.export_documents_csv(\n    start_date=date(2024, 1, 1),\n    end_date=date(2024, 1, 31),\n    tag_ids=[1, 2],\n    include_items=True\n)\n\n# Save CSV file\nwith open(\"export.csv\", \"w\", encoding=\"utf-8-sig\") as f:\n    f.write(csv_content)\n\n# Generate monthly PDF report\npdf_content = pdf_service.generate_monthly_report(2024, 1)\n\n# Save PDF file\nwith open(\"monthly_report.pdf\", \"wb\") as f:\n    f.write(pdf_content)\n\n# Export chart PNG\npng_content = pdf_service.export_chart(\"donut\", {\"month\": \"2024-01\"})\n\n# Save PNG file\nwith open(\"donut_chart.png\", \"wb\") as f:\n    f.write(png_content)\n</code></pre>"},{"location":"services/export/#output-formats","title":"Output Formats","text":""},{"location":"services/export/#export-documents-without-items","title":"Export documents (without items)","text":"<pre><code>ID;Date;Time;Merchant;Location;Type;Amount;Currency;Transaction Type;Tags;Original File\n1;2024-01-15;14:30:00;Carrefour;Paris;receipt;45.67;EUR;Expense;Groceries;ticket.jpg\n</code></pre> Column Description ID Unique identifier Date Document date (YYYY-MM-DD) Time Time if available (HH:MM:SS) Merchant Business name Location Address/city Type Document type Amount Total amount Currency Currency code (EUR, USD...) Transaction Type Income or Expense Tags Comma-separated tags Original File Name of the uploaded file"},{"location":"services/export/#export-documents-with-items","title":"Export documents (with items)","text":"<pre><code>Document ID;Date;Merchant;Item;Quantity;Unit;Unit Price;Total Price;Item Category;Document Tags\n1;2024-01-15;Carrefour;Golden Apples;1.50;kg;2.99;4.49;Fruits;Groceries\n1;2024-01-15;Carrefour;Baguette;2.00;;1.20;2.40;Bakery;Groceries\n</code></pre>"},{"location":"services/export/#monthly-csv-export","title":"Monthly CSV Export","text":"<pre><code>Monthly Summary;2024-01\n\nMetric;Value\nTotal Expenses;1250.75 EUR\nTotal Income;3500.00 EUR\nBalance;2249.25 EUR\nNumber of Transactions;42\n\nExpenses by Category\nTag;Amount;Percentage\nGroceries;450.30 EUR;36.0%\nTransport;180.00 EUR;14.4%\n</code></pre>"},{"location":"services/export/#pdf-reports","title":"PDF Reports","text":"<p>PDF reports (monthly and annual) provide a structured layout with a financial summary, tables, and dynamically generated charts.</p>"},{"location":"services/export/#png-charts","title":"PNG Charts","text":"<p>PNG chart exports provide high-resolution images of data visualizations.</p>"},{"location":"services/export/#csv-configuration","title":"CSV Configuration","text":"<pre><code># Separator: semicolon (Excel FR)\nwriter = csv.writer(output, delimiter=';', quoting=csv.QUOTE_MINIMAL)\n</code></pre>"},{"location":"services/export/#encoding","title":"Encoding","text":"<p>Files are generated in UTF-8 with BOM for Excel compatibility:</p> <pre><code># In the API route\nreturn StreamingResponse(\n    iter([csv_content]),\n    media_type=\"text/csv; charset=utf-8\",\n    headers={\n        \"Content-Disposition\": f'attachment; filename=\"{filename}\"',\n    }\n)\n</code></pre>"},{"location":"services/export/#performance","title":"Performance","text":"Number of Documents Generation Time 100 &lt; 1s 1000 2-3s 10000 10-15s <p>For large exports, generation is streamed to avoid memory issues.</p>"},{"location":"services/nas-sync/","title":"NAS Sync Service (SMB)","text":"<p>The NAS synchronization service transfers files to a NAS via an SMB/CIFS mount.</p>"},{"location":"services/nas-sync/#architecture","title":"Architecture","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         BACKEND                              \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502              nas_sync_service.py                       \u2502  \u2502\n\u2502  \u2502                                                        \u2502  \u2502\n\u2502  \u2502  def sync_file(document):                             \u2502  \u2502\n\u2502  \u2502      dest = get_destination_path(document)            \u2502  \u2502\n\u2502  \u2502      os.makedirs(dest_dir, exist_ok=True)             \u2502  \u2502\n\u2502  \u2502      shutil.copy2(src, dest)  # Simple copy!          \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                            \u2502 Local file copy\n                            \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    SMB MOUNT                                \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502  /app/nas_backup (in container)                         \u2502  \u2502\n\u2502  \u2502       \u2502                                                \u2502  \u2502\n\u2502  \u2502       \u2514\u2500\u2500 mounted from /Volumes/NAS/finance (Mac)     \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502                           \u2502                                  \u2502\n\u2502                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2510                          \u2502\n\u2502                    \u2502  NAS Ugreen \u2502                          \u2502\n\u2502                    \u2502    (SMB)    \u2502                          \u2502\n\u2502                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"services/nas-sync/#source-file","title":"Source File","text":"<p><code>backend/app/services/nas_sync_service.py</code></p>"},{"location":"services/nas-sync/#advantages-over-sshrsync","title":"Advantages over SSH/rsync","text":"Criterion SSH/rsync (old) SMB (new) Configuration Complex (SSH keys) Simple (mount) Authentication SSH key Native SMB credentials Performance Good Good NAS Compatibility Variable Universal Python Code subprocess + rsync shutil.copy2"},{"location":"services/nas-sync/#configuration","title":"Configuration","text":""},{"location":"services/nas-sync/#1-mount-the-smb-share-on-mac","title":"1. Mount the SMB share on Mac","text":"<pre><code># Create mount point\nsudo mkdir -p /Volumes/NAS\n\n# Mount SMB share\nmount -t smbfs //username:password@NAS-IP/share /Volumes/NAS\n\n# Or via Finder: Cmd+K \u2192 smb://NAS-IP/share\n</code></pre>"},{"location":"services/nas-sync/#2-environment-variables-env","title":"2. Environment Variables (.env)","text":"<pre><code># Path on Mac (SMB mount)\nNAS_LOCAL_PATH=/Volumes/NAS/finance\n\n# Path in Docker container\nNAS_MOUNT_PATH=/app/nas_backup\n</code></pre>"},{"location":"services/nas-sync/#3-docker-composeyml","title":"3. docker compose.yml","text":"<pre><code>backend:\n  volumes:\n    - ${NAS_LOCAL_PATH:-./nas_backup}:/app/nas_backup\n  environment:\n    - NAS_MOUNT_PATH=${NAS_MOUNT_PATH:-}\n</code></pre>"},{"location":"services/nas-sync/#file-structure-on-nas","title":"File Structure on NAS","text":"<p>Files are organized by year/month/type:</p> <pre><code>/Volumes/NAS/finance/\n\u251c\u2500\u2500 2024/\n\u2502   \u251c\u2500\u2500 01/\n\u2502   \u2502   \u251c\u2500\u2500 invoices/\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 abc123.pdf\n\u2502   \u2502   \u251c\u2500\u2500 receipts/\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 def456.jpg\n\u2502   \u2502   \u2514\u2500\u2500 salaries/\n\u2502   \u2502       \u2514\u2500\u2500 ghi789.pdf\n\u2502   \u251c\u2500\u2500 02/\n\u2502   \u2502   \u2514\u2500\u2500 ...\n\u2502   \u2514\u2500\u2500 ...\n\u251c\u2500\u2500 2025/\n\u2502   \u2514\u2500\u2500 ...\n\u2514\u2500\u2500 2026/\n    \u2514\u2500\u2500 01/\n        \u251c\u2500\u2500 invoices/\n        \u2514\u2500\u2500 receipts/\n</code></pre>"},{"location":"services/nas-sync/#document-type-mapping","title":"Document Type Mapping","text":"Type (DB) NAS Folder receipt receipts invoice invoices payslip salaries other others"},{"location":"services/nas-sync/#classes","title":"Classes","text":""},{"location":"services/nas-sync/#nassyncservice","title":"NASSyncService","text":"<pre><code>class NASSyncService:\n    def is_configured(self) -&gt; bool:\n        \"\"\"Checks if the NAS mount is accessible.\"\"\"\n\n    def get_config_status(self) -&gt; dict:\n        \"\"\"Returns the configuration status.\"\"\"\n\n    def test_connection(self) -&gt; tuple[bool, str]:\n        \"\"\"Tests write access to the mount.\"\"\"\n\n    def sync_file(self, document: Document) -&gt; tuple[bool, str]:\n        \"\"\"Synchronizes a specific file.\"\"\"\n\n    def sync_all_pending(self, user_id: int) -&gt; dict:\n        \"\"\"Synchronizes all pending files.\"\"\"\n\n    def get_sync_stats(self, user_id: int) -&gt; dict:\n        \"\"\"Returns synchronization statistics.\"\"\"\n</code></pre>"},{"location":"services/nas-sync/#internal-methods","title":"Internal Methods","text":"<pre><code>def _get_doc_type_folder(self, doc_type: str) -&gt; str:\n    \"\"\"Converts document type to folder name.\"\"\"\n    type_mapping = {\n        \"receipt\": \"receipts\",\n        \"invoice\": \"invoices\",\n        \"payslip\": \"salaries\",\n        \"other\": \"others\",\n    }\n    return type_mapping.get(doc_type, \"others\")\n\ndef _get_destination_path(self, document: Document) -&gt; str:\n    \"\"\"Builds the path: {nas}/{year}/{month}/{type}/{file}\"\"\"\n    doc_date = document.date or document.created_at.date()\n    year = str(doc_date.year)\n    month = str(doc_date.month).zfill(2)\n    type_folder = self._get_doc_type_folder(document.doc_type)\n    filename = os.path.basename(document.file_path)\n    return os.path.join(self.nas_mount_path, year, month, type_folder, filename)\n</code></pre>"},{"location":"services/nas-sync/#usage","title":"Usage","text":"<pre><code>from app.services.nas_sync_service import get_nas_sync_service\n\n# Create the service\nsync_service = get_nas_sync_service(db)\n\n# Check configuration\nif not sync_service.is_configured():\n    print(\"NAS mount not accessible\")\n    return\n\n# Test access\nsuccess, message = sync_service.test_connection()\nif not success:\n    print(f\"Error: {message}\")\n    return\n\n# Synchronize a document\ndocument = db.query(Document).get(1)\nsuccess, message = sync_service.sync_file(document)\n\n# Synchronize all pending documents\nresults = sync_service.sync_all_pending(user_id=1)\nprint(f\"Synced: {results['synced']}\")\nprint(f\"Failures: {results['failed']}\")\n</code></pre>"},{"location":"services/nas-sync/#api-endpoints","title":"API Endpoints","text":""},{"location":"services/nas-sync/#get-syncstatus","title":"GET /sync/status","text":"<p>Synchronization statistics.</p> <pre><code>{\n  \"total_documents\": 150,\n  \"synced\": 142,\n  \"pending\": 8,\n  \"sync_percentage\": 94.7,\n  \"last_sync\": \"2024-01-15T14:30:00\",\n  \"nas_configured\": true\n}\n</code></pre>"},{"location":"services/nas-sync/#get-syncconfig","title":"GET /sync/config","text":"<p>NAS configuration status.</p> <pre><code>{\n  \"configured\": true,\n  \"nas_host\": true,\n  \"nas_user\": true,\n  \"nas_path\": true,\n  \"host\": \"SMB Mount\",\n  \"path\": \"/app/nas_backup\",\n  \"path_exists\": true,\n  \"path_writable\": true\n}\n</code></pre>"},{"location":"services/nas-sync/#post-test","title":"POST /test","text":"<p>Tests mount access.</p> <pre><code>{\n  \"success\": true,\n  \"message\": \"NAS mount accessible for read/write\"\n}\n</code></pre>"},{"location":"services/nas-sync/#post-run","title":"POST /run","text":"<p>Starts synchronization of all pending documents.</p> <pre><code>{\n  \"total\": 8,\n  \"synced\": 7,\n  \"failed\": 1,\n  \"errors\": [\"Document 42: Permission denied\"]\n}\n</code></pre>"},{"location":"services/nas-sync/#post-documentdocument_id","title":"POST /document/{document_id}","text":"<p>Synchronizes a specific document.</p> <pre><code>{\n  \"success\": true,\n  \"message\": \"Synchronized to /app/nas_backup/2024/01/invoices/abc.pdf\"\n}\n</code></pre>"},{"location":"services/nas-sync/#error-handling","title":"Error Handling","text":"Error Cause Solution NAS not configured NAS_MOUNT_PATH empty Define variable in .env Path non-existent Mount not performed Mount SMB share on Mac Permission denied Insufficient rights Check SMB permissions Disk space NAS full Free up space"},{"location":"services/nas-sync/#database-update","title":"Database Update","text":"<p>After successful synchronization:</p> <pre><code>document.synced_to_nas = True\ndocument.synced_at = datetime.utcnow()\ndb.commit()\n</code></pre>"},{"location":"services/nas-sync/#best-practices","title":"Best Practices","text":""},{"location":"services/nas-sync/#automatic-mounting-macos","title":"Automatic Mounting (macOS)","text":"<p>To mount automatically on startup, add to <code>/etc/fstab</code>:</p> <pre><code>//user:pass@nas-ip/share /Volumes/NAS smbfs 0 0\n</code></pre> <p>Or use the \"Automator\" app for a login script.</p>"},{"location":"services/nas-sync/#security","title":"Security","text":"<ul> <li>Create a dedicated SMB user on the NAS</li> <li>Limit permissions to the finance folder only</li> <li>Do not expose the NAS to the Internet</li> </ul>"},{"location":"services/nas-sync/#reliability","title":"Reliability","text":"<ul> <li>Check if the mount is active before starting Docker</li> <li>Monitor NAS disk space</li> <li>Back up the NAS regularly</li> </ul>"},{"location":"services/ocr/","title":"OCR Service (Microservice)","text":"<p>The OCR service is an independent microservice that uses PaddleOCR to extract text from documents.</p>"},{"location":"services/ocr/#architecture","title":"Architecture","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         BACKEND                              \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502              ocr_service.py (HTTP Client)             \u2502  \u2502\n\u2502  \u2502                                                        \u2502  \u2502\n\u2502  \u2502  async def extract_text(file_path):                   \u2502  \u2502\n\u2502  \u2502      response = await client.post(                     \u2502  \u2502\n\u2502  \u2502          f\"{OCR_SERVICE_URL}/ocr\",                    \u2502  \u2502\n\u2502  \u2502          json={\"file_path\": file_path}                \u2502  \u2502\n\u2502  \u2502      )                                                 \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                            \u2502 HTTP POST :5001\n                            \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    OCR SERVICE (Flask)                       \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502                     app.py                             \u2502  \u2502\n\u2502  \u2502                                                        \u2502  \u2502\n\u2502  \u2502  @app.route('/ocr', methods=['POST'])                 \u2502  \u2502\n\u2502  \u2502  def ocr():                                            \u2502  \u2502\n\u2502  \u2502      file_path = request.json['file_path']            \u2502  \u2502\n\u2502  \u2502      result = paddle_ocr.ocr(file_path)               \u2502  \u2502\n\u2502  \u2502      return {\"text\": ..., \"confidence\": ...}          \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502                           \u2502                                  \u2502\n\u2502                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2510                          \u2502\n\u2502                    \u2502  PaddleOCR  \u2502                          \u2502\n\u2502                    \u2502  (CPU/GPU)  \u2502                          \u2502\n\u2502                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"services/ocr/#source-files","title":"Source Files","text":"File Description <code>ocr_service/app.py</code> Flask microservice with <code>/ocr</code> endpoint <code>ocr_service/Dockerfile</code> Docker image with PaddleOCR <code>ocr_service/requirements.txt</code> Python dependencies <code>backend/app/services/ocr_service.py</code> HTTP Client (backend side)"},{"location":"services/ocr/#microservice-api","title":"Microservice API","text":""},{"location":"services/ocr/#post-ocr","title":"POST /ocr","text":"<p>Extracts text from a file.</p> <p>Request: <pre><code>{\n  \"file_path\": \"/app/uploads/abc123.jpg\"\n}\n</code></pre></p> <p>Response (success): <pre><code>{\n  \"success\": true,\n  \"text\": \"CARREFOUR\\nReceipt\\n...\",\n  \"confidence\": 92.5,\n  \"error\": null\n}\n</code></pre></p> <p>Response (error): <pre><code>{\n  \"success\": false,\n  \"text\": \"\",\n  \"confidence\": 0,\n  \"error\": \"File not found\"\n}\n</code></pre></p>"},{"location":"services/ocr/#get-health","title":"GET /health","text":"<p>Service health check.</p> <p>Response: <pre><code>{\n  \"status\": \"healthy\",\n  \"paddle_ocr\": \"loaded\"\n}\n</code></pre></p>"},{"location":"services/ocr/#backend-client","title":"Backend Client","text":""},{"location":"services/ocr/#ocrresult","title":"OCRResult","text":"<p>Result of an OCR extraction.</p> <pre><code>@dataclass\nclass OCRResult:\n    text: str           # Extracted text\n    confidence: float   # Confidence score (0-100)\n    success: bool       # Extraction successful\n    error: str | None   # Error message if failed\n</code></pre>"},{"location":"services/ocr/#ocrservice","title":"OCRService","text":"<p>HTTP client to the microservice.</p> <pre><code>class OCRService:\n    def __init__(self, service_url: str):\n        self.service_url = service_url\n        self._client = None\n\n    async def extract_text(self, file_path: str) -&gt; OCRResult:\n        \"\"\"\n        Calls the OCR microservice to extract text.\n\n        Args:\n            file_path: Absolute path to the file\n\n        Returns:\n            OCRResult with text and confidence score\n        \"\"\"\n        response = await self._client.post(\n            f\"{self.service_url}/ocr\",\n            json={\"file_path\": file_path}\n        )\n        data = response.json()\n        return OCRResult(**data)\n</code></pre>"},{"location":"services/ocr/#usage","title":"Usage","text":"<pre><code>from app.services.ocr_service import get_ocr_service\n\n# Get a service instance\nocr = get_ocr_service()\n\n# Extract text from an image (async HTTP call)\nresult = await ocr.extract_text(\"/app/uploads/receipt.jpg\")\n\nif result.success:\n    print(f\"Text: {result.text}\")\n    print(f\"Confidence: {result.confidence}%\")\nelse:\n    print(f\"Error: {result.error}\")\n</code></pre>"},{"location":"services/ocr/#configuration","title":"Configuration","text":""},{"location":"services/ocr/#environment-variables","title":"Environment Variables","text":"<pre><code># OCR microservice URL (in backend)\nOCR_SERVICE_URL=http://ocr-service:5001\n</code></pre>"},{"location":"services/ocr/#paddleocr-parameters","title":"PaddleOCR Parameters","text":"Parameter Value Description use_angle_cls True Orientation detection and correction lang fr Model language use_gpu False CPU usage (M1 compatible) show_log False Logs disabled"},{"location":"services/ocr/#docker","title":"Docker","text":""},{"location":"services/ocr/#microservice-dockerfile","title":"Microservice Dockerfile","text":"<pre><code>FROM python:3.11-slim\n\n# System dependencies for OpenCV\nRUN apt-get update &amp;&amp; apt-get install -y \\\n    libgl1 libglib2.0-0 libsm6 libxext6 libxrender1 \\\n    &amp;&amp; rm -rf /var/lib/apt/lists/*\n\nWORKDIR /app\nCOPY requirements.txt .\nRUN pip install --no-cache-dir -r requirements.txt\n\nCOPY app.py .\nEXPOSE 5001\nCMD [\"python\", \"app.py\"]\n</code></pre>"},{"location":"services/ocr/#docker-composeyml","title":"docker compose.yml","text":"<pre><code>ocr-service:\n  build:\n    context: ./ocr_service\n    dockerfile: Dockerfile\n  container_name: finance-ocr-service\n  ports:\n    - \"5001:5001\"\n  volumes:\n    - ./uploads:/app/uploads  # Access to uploaded files\n  restart: unless-stopped\n</code></pre>"},{"location":"services/ocr/#supported-formats","title":"Supported Formats","text":"Format Extension Notes JPEG .jpg, .jpeg Recommended format PNG .png Good quality WebP .webp Compact GIF .gif First frame PDF .pdf Converted to images"},{"location":"services/ocr/#performance","title":"Performance","text":"Document Type Average Time Average Confidence Receipt 1-2s 85-95% PDF Invoice 2-4s 90-98% Blurry Photo 2-3s 60-80%"},{"location":"services/ocr/#microservice-advantages","title":"Microservice Advantages","text":"<ol> <li>Isolation : PaddleOCR and its heavy dependencies (numpy, opencv) are isolated</li> <li>Scalability : Can be scaled independently</li> <li>Maintenance : Update without touching the backend</li> <li>Resources : Separate memory management (PaddleOCR is memory intensive)</li> <li>Compatibility : Avoids dependency conflicts with the backend</li> </ol>"},{"location":"services/ocr/#error-handling","title":"Error Handling","text":"Error Cause Solution Connection refused Service not started <code>docker compose up ocr-service</code> File not found Invalid path Check volume mounts Timeout File too large Increase timeout (default: 60s) Low confidence Blurry image Improve scan quality"}]}